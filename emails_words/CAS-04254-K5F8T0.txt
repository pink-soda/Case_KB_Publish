邮件主题：回复: 答复: 转发: 回复: 回复: 【外来邮件，注意核实】回复: [案例号: CAS-04254-K5F8T0 ] % |P2|ICBC|视频客服VTM业务审核偶发卡死 % 初次响应 CMIT:0001821

====第1封邮件====

发件人：Wei Liang
发送时间：2021-05-27 17:21:53.786000+00:00
邮件内容:
吴先生 您好：
根据刚才的电话沟通，我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
视频客服VTM业务审核偶发卡死 ，开发团队目前评估是由于浏览器内存在业务办理时逐步增加，最终超过浏览器限额，导致浏览器卡死。
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
测试建议：
1、IE浏览器内TAB（标签页）的运行模式为32位，通过添加以下注册表项，使用64位IE浏览器验证应用运行情况。
以管理员权限打开cmd命令行，运行以下命令添加注册表项，再重新打开IE浏览器验证应用。
reg add "HKCU\Software\Microsoft\Internet Explorer\Main" /v TabProcGrowth /t REG_DWORD /d 0x0
2、安装第三方的64位浏览器，使用其他浏览器验证应用运行情况。

====第2封邮件====

发件人：win10升级支持
发送时间：2021-05-27 17:45:12.432000+00:00
邮件内容:
根据目前跟研发确认的情况，无法使用64位的IE。受音频文件限制，只能使用32位的。应该就是之前的案例复现了。 
EDGE目前不支持该插件的运行，能否从系统层面协助西安解决该问题？ 

====第3封邮件====

发件人：Wei Liang
发送时间：2021-05-28 15:39:01.249000+00:00
邮件内容:
吴先生 您好：
经TAM与您沟通的结果，此问题可暂时挂起。
如有需要操作系统层面协助分析的，可以明确需要分析的需求和内容，我们将全力支持配合用户的要求进行相关问题的分析，但由于是第三方问题，我们对结果无法承诺。

====第4封邮件====

发件人：win10升级支持
发送时间：2021-06-04 09:58:55.755000+00:00
邮件内容:
危工，案例需要进一步分析。请提供空间地址方便日志传输，另外对于该问题。由于插件属于第三方公司开发，可否由我们发起会议邀请你们与第三方公司进一步沟通确认,如何优化插件提升内存使用率？ 

====第5封邮件====

发件人：Wei Liang
发送时间：2021-06-04 17:09:10.435000+00:00
邮件内容:
吴先生 您好：
根据您提供的信息和开发团队的分析，问题是由于浏览器内存在业务办理时逐步增加，最终超过浏览器内存限额，导致浏览器卡死。
IE浏览器内存限额是32位IE进程架构所决定的，内存使用到1.3G以上就会发生IE崩溃问题。
对于此问题，我们提出以下几点建议：
一、首先，用户可以在使用这些高内存需求的网页应用时每隔一段时间重启一下浏览器。
二、其次，建议请第三方插件厂商提供最新版本、支持64位IE浏览器的插件。

====第6封邮件====

发件人：Wei Liang
发送时间：2021-06-10 17:33:25.951000+00:00
邮件内容:
吴先生 您好：
针对添加注册表项TabProcGrowth并设置为0，出现的多页面使用同一进程的问题，
可先删除此注册表项，再尝试使用另一种方式开启64位IE。这种方式可以开启多进程使用64位IE：
打开IE的“高级”设置，然后开启下面两个选项：
1) 启用增强保护模式
2) 对于增强保护模式开启64位进程
开启后，只要站点所在的安全区域（Security Zone）的保护模式为开启，那么它的保护模式会变为增强。
默认情况下只有Internet站点的保护模式是开启的，受信任站点和本地Intranet站点的保护模式默认是关闭的。因此内网用户还要开启受信任站点和本地Intranet站点的保护模式。
使用增强保护模式开启64位IE需要相关的插件支持增强保护模式功能。

====第7封邮件====

发件人：Wei Liang
发送时间：2021-06-22 17:58:15.227000+00:00
邮件内容:
吴先生 您好：
根据之前多次邮件沟通，我方已明确排查出问题是由于三方应用在内存管理方面未做有效优化，导致IE浏览器进程占用内存超过32位IE的1.3GB内存使用限制，进而引起IE崩溃。IE内存限制属于产品设计，是32位IE进程架构所决定的，而非bug，三方应用的开发者应根据此产品特点开发和优化相关代码以适配IE11的运行环境。操作系统方无法做反向适配。
由于此问题由三方应用导致，操作系统方面无后续可执行步骤，案例将暂时归档。

====第8封邮件====

发件人：Wei Liang
发送时间：2021-06-25 17:33:57.285000+00:00
邮件内容:
吴先生 您好：
根据上午的会议沟通，我们使用工具收集相关日志协助分析VTM业务审核偶发卡死问题，请您从以下链接下载工具收集日志，并通过sftp上传给我们。
我们将全力配合进行相关问题的分析，但由于是三方应用问题，我们对结果无法承诺。
工具下载链接：
https://cduc.cmgos.com/download.php?id=283&token=MWjmHHiPEel9MmvA7KPuFiOIdFB8Levn
日志收集：
一、在使用VTM业务的计算机上运行CMGELogCollector.exe，使用勾选的默认项，点击收集，生成日志压缩文件。
二、在使用VTM业务的计算机上安装debugdiagx64.msi应用，按照安装向导默认安装即可。
1）在IE浏览器中打开VTM业务
2）在开始菜单中选择DebugDiag 2 Collection运行，添加规则选择Native（non-.NET）Memory and Handle Leak
3）选择iexplorer.exe 32位进程
4）配置userdump规则，如图所示，表示当private bytes超过300M的时候开始产生dump，每升高100M抓取一个。当virtual bytes超过500M的时候开始产生dump，每升高200M抓取一个，然后点击Save & Close，然后点击下一步
5）选择userdump存放位置，（请设置路径到有充足磁盘空间的地方，dump的大小和进程内存占用大小差不多，这个规则最多产生10个dump，所以要10G+空间），然后点击下一步。
6）选择Activate the rule now，点击完成。
7）配置如果跳出其他提示，点击“是”或者“确定”即可。
Rule的状态是Tracking表示正常。
8）然后操作VTM业务，当内存占用达到设定的规则时，会自动生成dump文件。
如果没有自动生成dump文件，可以退出debugdiag 2 collection应用，在“服务”管理界面重启“Debug Diagnostic Service”服务，再次配置debugdiag 2 collection规则。
三、当IE卡死时，在任务管理器中找到卡死的IE的进程PID，然后在使用管理员权限的cmd命令行中，切换到procdump文件所在路径，运行以下命令（PID以2232为例），生成dump文件。
procdump -ma 2232
四、请在IE的F12开发者工具中收集性能日志。
收集的log、dump等日志压缩后，使用sftp上传。

====第9封邮件====

发件人：Wei Liang
发送时间：2021-07-01 16:34:40.706000+00:00
邮件内容:
吴先生 您好：
经过我们确认，IE11使用iframe内存不能完全回收这在IE11上面是一个by design的表现，使用javascript garbageCollection()能再回收掉一部分，但是还有一部分resource不会释放。
建议使用其它方案替代iframe，html - Alternative to iFrames with HTML5 - Stack Overflow <https://stackoverflow.com/questions/8702704/alternative-to-iframes-with-html5> 供您参考。

====第10封邮件====

发件人：Wei Liang
发送时间：2021-07-30 14:27:01.287000+00:00
邮件内容:
吴先生 您好：
根据与您的电话沟通确认，我将暂时归档此案例。
工单的归档并不会影响我们为您提供技术支持服务，如您的问题复现或者有其他问题，您可以致电技术支持热线4008180055。
案例总结：
----
问题定义：
视频客服VTM业务审核偶发卡死 ，开发团队目前评估是由于浏览器内存在业务办理时逐步增加，最终超过浏览器限额，导致浏览器卡死。
问题总结：
与工行联系人确认，同意归档案例。
视频客户VTM业务审核页面程序使用iframe，出现内存不能完全回收这在IE11上面是一个by design的表现，建议使用其他方案替代。
应用开发人员后续计划基于chromium内核对应用进行改造。
以上，如您后续有任何问题，可随时与我们联系，谢谢。
