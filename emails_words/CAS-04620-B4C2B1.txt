邮件主题：回复: 转发: 【外来邮件，注意核实】回复: [案例号: CAS-04620-B4C2B1 ] % |P2|ICBC|工行用户咨询软件在系统注册表键值问题 % 初次响应 CMIT:0001754

====第1封邮件====

发件人：Jia Wei
发送时间：2021-08-12 17:29:38.651000+00:00
邮件内容:
--------------

====第2封邮件====

发件人：Jia Wei
发送时间：2021-08-13 13:51:39.753000+00:00
邮件内容:
吴先生, 您好!
问题定义: 
1）判断目前系统上已安装软件的方法（只能以注册表为标的进行判断）。
2）注册表HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall和HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\下的项及其键值代表意思？为什么从控制面板卸载软件后，此位置还有残留？
问题范围: 我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。 
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。 
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。 
由于此问题涉及到了非系统原生应用，我会从操作系统角度出发尽力找到缓解此问题的方法，如果涉及到三方软件的产品设计问题，则后续需要引入此软件的供应商。
案例分析：
1）针对您提出的第一个问题，结合收集到的信息我们在本地环境进行了测试，结果表明HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall和HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall之下的项代表着在系统上安装着的一个应用程序，而里面的键值可以直接反应在控制面板-程序-程序和功能里。所以扫描这两个位置可以获取当前安装软件的信息。此外，某些软件会安装到%userprofile%\AppData目录下，通常这些软件的安装不需要管理员权限，此时需要查询HKEY_CURRENT_USER对应的注册表位置。
此外，规范编写的应用程序安装时会注册到如下位置，卸载之后也应该清理对应注册表位置，您可以对比参考：
All Users:HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\App Paths
Per User: HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\App Paths
https://docs.microsoft.com/en-us/windows/win32/shell/app-registration#:~:text=An%20application%20that%20is%20installed%20for%20per%20user,Microsoft%20%20Windows%20%20CurrentVersion%20%20App%20Paths.
2）Uninstall注册表项下其中一些键值的解析如下：
DisplayIcon：在程序和功能对应名称一栏的图标
DisplayName：在程序和功能对应名称一栏程序的名称
DisplayVersion：在程序和功能对应版本信息
Publisher：在程序和功能对应发布者
EstimatedSize: 在程序和功能对应大小
SystemComponent：0-在程序和功能中显示此程序，1-隐藏此程序。改为1之后，则该程序不会出现在程序和功能中。
3）如果从控制面板卸载软件，调用了UninstallString中的数据，对应各个软件的卸载可执行文件（例如uninstall.exe）进行卸载，如果卸载程序之后注册表有残留，涉及到不同软件开发厂商对于uninstall程序行为定义的差异，需要咨询软件开发商解决。
4）Windows注册表是计算机上所有硬件、软件和用户首选项设置的数据库，控制Windows如何与硬件和应用程序交互。Windows在后台不断引用注册表，注册表不是被设计用来访问或编辑的。当您手动或使用工具错误地修改注、清理册表时，可能会出现严重的问题。如果由于这些问题造成了系统不稳定，那么可能因此需要用户重新安装操作系统。
--------------

====第3封邮件====

发件人：Jia Wei
发送时间：2021-08-19 14:35:15.889000+00:00
邮件内容:
吴先生, 您好!
很高兴与您电话沟通，根据沟通的结果，我将暂时归档此问题。案例归档后您会收到调查问卷的邮件，希望可以对我们的服务进行评价。
工单的归档并不会影响我们为您提供技术支持服务，如果您的问题复现，或有新的问题出现，您也可以致电我们的技术支持热线4008180055。
案例总结：
案例描述：
1）判断目前系统上已安装软件的方法（只能以注册表为标的进行判断）。
2）注册表HKLM\SOFTWARE\Microsoft\Windows\CurrentVersion\Uninstall和HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall\下的项及其键值代表意思？为什么从控制面板卸载软件后，此位置还有残留？
案例进展：
已提供上封邮件“案例分析”中关于上述问题的相关信息，和用户确认可以归档案例。
--------------

====第4封邮件====

发件人：Jia Wei
发送时间：2021-08-25 17:50:57.367000+00:00
邮件内容:
李先生，鲍女士，您好
案例背景：
根据之前的沟通结果，目前管控软件的逻辑是：
1.      获取系统已安装软件列表；
2.      对比黑名单，确认软件是否是在黑名单中；
3.      如果是，则向用户发出告警，提示用户在”程序和功能”界面中手动卸载此软件；
案例分析：
*   根据之前的调研，SystemComponent键值不存在或者不为1，此应用均会显示在”程序和功能”界面。如果为1，则在”程序和功能”界面中隐藏。
*   根据目前的测试结果，对于某些软件如果用户手动将SystemComponent和WindowsInstaller都改为不为1（例如都是0），就会出现应用在“程序和功能”界面被隐藏的问题。
*   在以上特殊情况下，管控软件扫描到黑名单中存在的且SystemComponent值不为1的软件后，其认为此软件应显示在”程序和功能”界面中并告警，而实际上用户无法在”程序和功能”界面中找到此软件进行手动卸载。
*   如之前邮件所说，应用软件是否显示在”程序和功能”界面是由软件自行定义的。同时，从操作系统角度看，不建议用户手动修改注册表以避免出现系统不稳定等问题。
基于目前的信息来看，我们发现了如下问题：
1.      某些软件安装后默认就会在”程序和功能”界面中隐藏（设置SystemComponent为1），如果该软件在黑名单中，用户同样无法通过”程序和功能”界面卸载；
2.      用户手动将SystemComponent键值设置为1，直接隐藏该软件，也无法通过”程序和功能”界面卸载。
以上问题都会造成用户无法直接卸载未允许安装的软件。
建议操作：
根据目前的需求，建议管控软件从以下注册表路径中找到UninstallString键值，直接获取Value并提供接口供客户卸载，类似如下界面的功能实现。
*   HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Uninstall
*   HKLM\SOFTWARE\WOW6432Node\Microsoft\Windows\CurrentVersion\Uninstall
*   HKCU\Software\Microsoft\Windows\CurrentVersion\Uninstall键下对应{GUID}或APP名称项 
--------------

====第5封邮件====

发件人：李汇腾
发送时间：2021-08-26 10:49:36.342000+00:00
邮件内容:
贾工，您好 
        我们需要先扫描出控制面板中的软件，匹配黑名单后，提供清单给管理员进行审计，所以需要一个可判断的规则，什么样的注册表值会让软件展现到控制面板中，能否帮忙确认下？多谢！ 

====第6封邮件====

发件人：Jia Wei
发送时间：2021-08-26 11:06:52.436000+00:00
邮件内容:
李先生，您好
很高兴与您电话沟通，也收到了您关于此问题的回复，我们将继续跟踪处理。
--------------

====第7封邮件====

发件人：win10升级支持
发送时间：2021-08-30 15:49:05.186000+00:00
邮件内容:
贾工你好 
        关于控制面板的软件有没有找到具体规则，麻烦告知下目前的进度。 

====第8封邮件====

发件人：Jia Wei
发送时间：2021-08-30 16:01:45.502000+00:00
邮件内容:
李先生，您好
针对您的问题：“除SystemComponent键值之外，WindowsInstaller键值对应用程序是否显示在”程序和功能”界面是否有影响”，我在本地进行了研究、测试。
案例分析：
附件为系统判断应用程序是否显示在”程序和功能”界面对应的注册表键值及其逻辑关系：《注册表键值逻辑图》可供您作为参考。
此外，看到您反馈针对此特殊场景“仅是测试方便而手动修改，实际使用不会让用户操作注册表的”，我们非常认同此观点，所以不建议引入手动修改后的场景进行测试。
--------------

====第9封邮件====

发件人：李汇腾
发送时间：2021-08-30 16:16:32.152000+00:00
邮件内容:
感谢贾工支持！ 

====第10封邮件====

发件人：Jia Wei
发送时间：2021-08-30 17:45:02.474000+00:00
邮件内容:
李先生，您好
没关系，如果对此问题您还有其他疑问，可以回复此邮件。
--------------

====第11封邮件====

发件人：Jia Wei
发送时间：2021-09-01 09:42:25.446000+00:00
邮件内容:
李先生, 您好!
很高兴与您电话沟通，根据沟通的结果，我将暂时归档此问题。案例归档后您会收到调查问卷的邮件，希望可以对我们的服务进行评价。
工单的归档并不会影响我们为您提供技术支持服务，如果您的问题复现，或有新的问题出现，您也可以致电我们的技术支持热线4008180055。
案例总结：
案例描述：
希望得到答案：除SystemComponent键值之外，WindowsInstaller键值对应用程序是否显示在”程序和功能”界面是否有影响
案例进展：
已提供关于客户问题的注册表键值对应逻辑关系图，经确认测试正常可以归档案例。
案例分析：
附件为系统判断应用程序是否显示在”程序和功能”界面对应的注册表键值及其逻辑关系：《注册表键值逻辑图》可供您作为参考。
此外，看到您反馈针对此特殊场景“仅是测试方便而手动修改，实际使用不会让用户操作注册表的”，我们非常认同此观点，所以不建议引入手动修改后的场景进行测试。
--------------
