邮件主题：回复: [案例号:CAS-11631-B2M1Q8] %|P2|ICBC|工行用户反馈V2020-L版本系统安装软件失败问题% 案例重新分配 CMIT:0001305

====第1封邮件====

发件人：Li Qi
发送时间：2024-06-26 16:54:53.565000+00:00
邮件内容:
许先生，您好：
       如刚才电话沟通，我谨以此封邮件阐述我们双方针对这个问题所涉及范围界定： 
问题定义: 
用户反馈安装软件失败问题，涉及3-4台设备，该问题在其他版本操作系统上也有出现，报错为：Swbemobiectset: 拍绝访问。需要协助分析处理。
问题范围: 
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。 
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。 
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。 
日志分析：
您发送的procmon日志无法查看，怀疑与procmon版本或用户收取步骤有关。请指导用户重新收集，最好收集可以安装和安装失败的两份对比日志。
另外为排除第三方软件的干扰，可以指导用户进入clean boot再尝试安装看是否正常。以下为进入clean boot的方式。
clean boot：
在运行栏内输入msconfig，调出系统配置，在“常规”下选择“有选择的启动”，勾选加载系统服务和加载启动项。在“服务”选项下，勾选“隐藏所有Microsoft服务”，再点击“全部禁用”-确定，重启进入Clean boot。
步骤操作： 
*	在运行栏内输入msconfig，调出系统配置 
*	在“常规”选项下选择“有选择的启动”，勾选加载系统服务和加载启动项 
*	在“服务”选项下，勾选“隐藏所有Microsoft服务”，再点击“全部禁用”-确定 
*	重启进入Clean boot

====第2封邮件====

发件人：Li Qi
发送时间：2024-07-02 10:14:29.278000+00:00
邮件内容:
许先生，您好：
如昨天沟通，当前用户遇到的部分电脑在安装cmclient应用过程中发生“拒绝访问”的报错问题。
根据您上传的第一份日志分析结果如下：
首先procmon中并没有找到错误弹框的进程，也没有cmclient的安装进程。这种情况有可能是在安装过程尚未开始，只是在最开始的安装准备阶段发生的问题。由于我们不清楚应用的安装逻辑，因此从已有的日志记录来看，exe的执行过程首先会交由7z进行解压，而在解压时会交由行业的管控软件进行实时扫描是否合规，而在此过程中出现access deny的情况。
由于行内的管控应用执行逻辑复杂，从日志中可以看到DSP,trend,Asiainfo均有参与。建议用户先卸载趋势进行排查。
下一步动作：
=======================
后续收到用户反馈，卸载趋势后问题依旧。因此收集第二份日志进行排查，为了更好的查看此问题，请收集正常与失败安装的对比日志以查看软件安装的执行逻辑，另外请让用户在问题电脑上执行CmgeLogCollecter收集系统日志。以确定具体问题发生点。谢谢

====第3封邮件====

发件人：Li Qi
发送时间：2024-07-02 15:28:29.214000+00:00
邮件内容:
许先生，您好：
根据您第二份日志中正常与失败的对比日志来看，在解压完成后，会正常进入安装包的安装过程，但失败日志中并没有进入到这个过程
因此可以明确问题发生在安装开始前的解压阶段，向前追溯安装包的解压过程会经过TMS的安全审查，审查通过后可以正常安装
而失败的电脑则被移入TMS安全审查移入D:\gscdatas文件夹过滤掉了，因此不再执行后续安装
因此可以让用户尝试卸载TMS完成安装，至于移入gscdatas的安全审查标准，请咨询TMS厂商处理。

====第4封邮件====

发件人：Li Qi
发送时间：2024-07-24 09:53:27.675000+00:00
邮件内容:
许先生，您好：
如刚才电话沟通，针对之前的日志分析，目前判断有一个可能是由于WMI class的丢失导致软件的安装失败。接下来请指导用户按照如下方式收集TSS日志：
1.	下载TSS工具：https://cduc.cmgos.com/download.php?id=1505&token=rCmPM7GY7750GSSQ9rmMVIpkWCk1kYBj
2.	管理员方式运行  .\TSS.ps1 -Scenario UEX_WMI -procmon
3.	根据提示，复现问题
看到如下的提示，复现问题，复现完问题之后，输入Y
4.	将最后产生的日志发送给我，谢谢。

====第5封邮件====

发件人：Li Qi
发送时间：2024-08-02 13:15:05.068000+00:00
邮件内容:
许先生，您好：
如刚才电话沟通，经您的确认，当前问题已解决，此case将做关闭处理，以下为案例总结，请您知悉：
Case No：CAS-11631-B2M1Q8
问题描述：
=================
用户反馈安装软件失败问题，涉及3-4台设备，该问题在其他版本操作系统上也有出现，报错为：Swbemobiectset: 拍绝访问。需要协助分析处理。
问题分析：
=================
经日志分析，怀疑在加域以后，wmi class 权限丢失导致软件安装失败。
其核心的报错的逻辑如下：
Wbemdisp!CSWbemObjectSet::get_Count
相关日志报错显示在安装过程中的报错由wbem返回
9:45:31.9877779 AM       工银e企邮_3.0.3-877_fh_amduni.tmp   8272              9948      RegCloseKey              HKLM\SOFTWARE\WOW6432Node\Microsoft\WBEM\CIMOM              SUCCESS                            1            INTRANET\hlfh-fujx01
9:45:31.9879243 AM       工银e企邮_3.0.3-877_fh_amduni.tmp   8272              9948      RegQueryKey     HKCU\Software\Classes  SUCCESS              Query: Name      1            INTRANET\hlfh-fujx01
案例总结：
=================
经与用户确认，在用户修复wmi之后可以正常安装软件，经用户同意，此case做关闭处理，如后续有其他问题需求，可随时与我联系，谢谢
