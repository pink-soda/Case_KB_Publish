邮件主题：回复: [案例号: CAS-09366-B8X7G5 ] % 联想开天OEM用户-中信证券用户反馈cmit更新客户端服务无法启用无法更新 % 初次响应 CMIT:0001130

====第1封邮件====

发件人：Wei Liang
发送时间：2023-07-13 11:07:16.331000+00:00
邮件内容:
李先生 您好：
感谢您的电话接听。
根据您提供的信息，我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
用户反馈有10几台设备的CmitUpdateAgent 服务无法启动，运行时报错：1067进程意外终止，需要协助分析。
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
麻烦您下载附件中的日志收集工具，选择二、三台出现问题的设备，并按照以下操作收取日志，协助我们进一步排查这个问题。
1）将附件中的工具解压，将其中的start.txt和stop.txt改名为start.bat和stop.bat。
2）以管理员权限运行start.bat，会自动启动procdump.exe和procmon.exe。
3）运行services.msc打开服务管理界面，启动CMIT更新客户端服务，复现1067进程意外终止问题。
4）以管理员权限运行 stop.bat，会在bat脚本所在目录生成类似cmitupdateagent.exe_xxxx.dmp文件以及log.pml文件，将生成的dmp文件和pml文件压缩后通过CDUC上传。
5）双击运行CMGELogCollectorV2.exe，勾选所有选项，点击收集获取对应的系统日志，将生成的日志压缩包通过CDUC上传。
日志上传方法：
用户名：zhongxin
密码：zhongxin
注意：添加文件，点击上传后，跳转到新的页面点击保存。

====第2封邮件====

发件人：Wei Liang
发送时间：2023-07-13 11:41:58.968000+00:00
邮件内容:
李先生 您好：
日志已经收到正在分析，有任何进展会及时与您沟通，谢谢。

====第3封邮件====

发件人：Wei Liang
发送时间：2023-07-13 15:55:53.608000+00:00
邮件内容:
李先生 您好：
查看系统的应用日志，提示CmitClientAgent.exe异常退出代码为0xc0000005。
Procmon日志显示应用退出状态为-1073741819。
查询其错误代码信息，也显示为0xc0000005，其表示数据冲突或拒绝访问错误。
查看CmitClientAgent的日志，提示OpenLocalMachineGPO failed!
查询器错误代码0x800703ee，其表示无效的文件。
CmitClientAgent需要访问本地的组策略文件，在procmon日志中可以查询到其访问组策略文件 C:\Windows\System32\GroupPolicy\Machine\Registry.pol。
查看日志中收集的GroupPolicy\Machine\Registry.pol文件，此文件大小为0，与操作系统默认的文件大小不一致。
建议进行以下操作修复此问题：
1）从可以正常启动CMIT更新客户端服务的设备上复制其中的C:\Windows\System32\GroupPolicy\Machine\Registry.pol文件，替换故障机上的C:\Windows\System32\GroupPolicy\Machine\中的Registry.pol文件 （GroupPolicy是隐藏文件夹，替换此文件会提示需要管理员权限）。
2）重新启动故障机。
3）再次启动CUA服务，验证CUA服务是否能正常运行。

====第4封邮件====

发件人：Wei Liang
发送时间：2023-07-13 16:27:25.696000+00:00
邮件内容:
李先生 您好：
感谢您的回复。
确认您的问题已经解决，我将归档此案例。
工单的归档并不会影响我们为您提供技术支持服务，如有其他问题，您可以随时联系我们。
案例总结：
----
问题定义：
用户反馈有10几台设备的CmitUpdateAgent 服务无法启动，运行时报错：1067进程意外终止，需要协助分析。
问题总结：
本地组策略文件Machine\Registry.pol损坏导致CUA服务无法启动，替换损坏的文件解决问题。
问题分析：
分析CUA客户端运行日志以及Procmon日志，确认Registry.pol文件损坏导致CUA服务无法启动。
建议进行以下操作修复此问题：
1）从可以正常启动CMIT更新客户端服务的设备上复制其中的C:\Windows\System32\GroupPolicy\Machine\Registry.pol文件，替换故障机上的C:\Windows\System32\GroupPolicy\Machine\中的Registry.pol文件 （GroupPolicy是隐藏文件夹，替换此文件会提示需要管理员权限）。
2）重新启动故障机。
3）再次启动CUA服务，验证CUA服务是否能正常运行。
以上，如您后续有任何问题，可随时与我们联系，谢谢。
