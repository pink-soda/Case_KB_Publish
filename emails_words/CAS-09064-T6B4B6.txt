邮件主题：回复: 【外来邮件，注意核实】回复: [案例号: CAS-09064-T6B4B6 ] % |P2|ICBC|工行用户反馈无法打开snipaste截图工具问题 % 初次响应 CMIT:0001470

====第1封邮件====

发件人：Wei Liang
发送时间：2023-05-31 18:06:11.630000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
根据您提供的信息，我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
用户反馈在工行环境下无法打开snipaste截图工具，运行时直接退出，需要协助分析，经确认snipaste截图工具在Win7环境下运行正常。
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
查看您提供的procmon日志，显示snipaste.exe运行时进程自动退出，退出代码为：-1073741819。
查询退出代码情况如下：
可能的问题为访问冲突或者访问被拒绝，从procmon日志中可以看到snipaste.exe加载了DSP应用的dll组件。
怀疑这些组件对snipaste应用有影响。
测试建议：
a) 是否可以暂时卸载DSP应用验证其对snipaste应用的影响。
b) 当前snipaste应用版本为1.16.2，其官网最新版本为2.8.5，请确认新版应用是否可以正常使用。
c) 针对1.16.2版本的snipaste应用，可以按照以下操作收集新的应用相关日志：
1）请从以下链接下载procdump.exe和config.ini文件：
https://cduc.cmgos.com/download.php?id=989&token=rLj6uogUjwHyvWsh0ifviMFlMtYkx2dr
2）将文件下载解压后，将procdump.exe和config.ini文件复制到snipaste.exe文件所在目录。
3）以管理员权限打开cmd命令行，切换到snipaste.exe文件所在目录（假如snipaste.exe文件所在目录为D:\ snipaste）
cd /d d:\snipaste
4）开启procdump.exe抓取snipaste.exe自动退出时生成dump文件。
procdump.exe -e -t -ma -w snipaste.exe
5）运行snipaste.exe复现截图工具未运行问题。
6）在D:\ snipaste目录复制splog.txt文件和snipaste.exe_xxxx_xxxx.dmp文件通过CDUC上传。

====第2封邮件====

发件人：Wei Liang
发送时间：2023-06-02 13:44:43.175000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
对比procmon日志和应用异常退出时的dump信息，初步判断截图工具运行时DSP注入的组件与截图工具自带的第三方组件openssl出现冲突导致截图工具无法运行。
建议测试如下：
1）DSP应用是否可以配置不注入snipaste.exe应用。
2）升级使用新版snipaste应用是否可以正常运行。
3）删除snipaste应用目录下的openssl组件：libeay32.dll和ssleay32.dll，作为缓解方案。
4）您反馈的有部分设备在相同环境下，snipaste.exe可以正常运行，请您使用procmon工具收集snipaste.exe可以正常运行的日志，用于对比查找问题。
日志具体分析如下：
procmon日志和dmp文件均显示snipaste.exe被注入了DSP相关组件。
两个日志均显示由于0xC0000005错误导致snipaste.exe运行失败。
查询退出代码情况如下：
dmp文件显示由于libeay32!OPENSSL_cleanse操作导致的访问冲突。
Libeay32.dll是第三方组件openssl的文件。
建议排查加载的第三方dll组件情况。

====第3封邮件====

发件人：Wei Liang
发送时间：2023-06-06 15:47:05.336000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
如电话中所说，请您使用procmon工具收集snipaste.exe可以正常运行的日志，用于对比查找问题。
如果有任何进展或疑问可以回复此邮件。

====第4封邮件====

发件人：Wei Liang
发送时间：2023-06-09 10:15:38.391000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
请您使用procmon工具收集snipaste.exe可以正常运行的日志，用于对比查找问题。
如果有任何进展或疑问可以回复此邮件。

====第5封邮件====

发件人：Wei Liang
发送时间：2023-06-13 11:27:49.265000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
请您与最终用户沟通使用procmon工具收集snipaste.exe可以正常运行的日志，用于对比查找问题。
如果有任何进展或疑问可以回复此邮件。

====第6封邮件====

发件人：Wei Liang
发送时间：2023-06-15 14:54:19.100000+00:00
邮件内容:
许先生 您好：
您提供的截图工具的新的dmp日志已经收到，会进一步查看这个dmp文件情况。但是初步发现对应的日志显示截图工具是在9天前启动运行的，也没有提供截图工具正常运行过程中的procmon日志。
请您再次使用procmon收集截图工具从开始到正常运行成功的过程的procmon日志，用于对比排查。
如果有任何进展或疑问可以回复此邮件。
电子邮箱： weiliang@cmgos.com
官方网站： www.cmgos.com
________________________________

====第7封邮件====

发件人：Wei Liang
发送时间：2023-06-16 14:00:26.766000+00:00
邮件内容:
许先生 您好：
查看您最新提供的snipaste可以正常运行的procmon日志，它未加载DSP相关的组件。
而snipaste无法运行的procmon日志显示其加载了DSP相关的组件。
结合以前的日志分析，在测试删除openssl相关组件（libeay32.dll和ssleay32.dll，其版本为1.0.2h）后snipaste可以正常运行，新版snipaste截图工具在相同环境中也能正常运行。
怀疑DSP注入的组件与截图工具自带的第三方组件openssl有兼容性问题导致snipaste截图工具无法运行。
测试建议：
1）DSP应用是否可以配置不注入snipaste.exe应用。
2）在不更新snipaste应用情况下，尝试更新snipaste应用目录下的openssl组件为1.0.2u版本，并验证snipaste工具运行情况。
从以下链接下载libeay32.dll和ssleay32.dll，替换snipaste应用目录下的同名文件。
https://cduc.cmgos.com/download.php?id=1005&token=n57PGnVYZEb6De2ILaKSUmXneuPGLq7Q

====第8封邮件====

发件人：win10技术支持
发送时间：2023-06-20 09:39:49.727000+00:00
邮件内容:
​
​电话沟通一下？
​
​☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆
中国工商银行软件开发中心（珠海）
许  翔
系统一部
电话：17606669571
☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆☆ 
​
________________________________
	-----原始邮件-----
	
====第9封邮件====

发件人：Wei Liang
发送时间：2023-06-20 11:29:06.144000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
关于snipaste截图工具问题，您反馈的卸载DSP后还是无法运行截图工具的情况，请您收集对应的procmon日志提供给我们进一步排查。
您也可以按照上一封邮件在您的设备上测试替换openssl对应的dll组件后，验证snipaste工具是否可以正常运行。
关于IE配置中的受信任的站点中“对该区域中的所有站点要求服务器验证(https:)”配置，我未找到对应的组策略配置，但是可以通过修改对应的注册表键值进行修改，您可以根据您内部实际环境情况使用相关的修改注册表方法（注意修改注册表键值时请关闭IE设置项）。
1）定位到：HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\2
2）查看右侧的Flags键值（十进制）：67为不勾选，71为勾选。
3）可以通过以下命令行修改Flags键值。
不勾选：
reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\2" /v flags /t reg_DWORD /d 67 /f
勾选：
reg add "HKEY_CURRENT_USER\Software\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\2" /v flags /t reg_DWORD /d 71 /f

====第10封邮件====

发件人：Wei Liang
发送时间：2023-06-20 18:05:13.613000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
查看您新上传的snipaste应用异常退出的dump文件，还是显示c0000005 (Access violation)访问冲突错误。
当前应用未加载其他应用厂商的组件，出错的是openssl组件libeay32，其版本为1.0.2h，是2016年5月发布的版本。
至于相同的软件环境下，相同版本的openssl组件在一些设备上可以运行，在一些设备上无法运行，由于openssl组件版本较低，怀疑与新的硬件存在兼容性问题，建议升级openssl到对应的1.0.2u版本。
具体分析情况：
Dump显示出现c0000005 (Access violation)错误，尝试从地址ffffffffffffffff读取数据。
查看libeay32版本为1.0.2h，是是2016年5月发布的版本。

====第11封邮件====

发件人：Wei Liang
发送时间：2023-06-25 17:27:43.385000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
根据收集的snipaste日志信息判断，snipaste截图工具在启动过程中由于0xC0000005（内存访问冲突）错误导致应用无法正常运行。
出现0xC0000005错误的组件是snipaste自带的第三方组件openssl的libeay32.dll文件，其版本为1.0.2h，是2016年5月发布的版本。
经过测试，发现snipaste截图工具在Intel 11代CPU上无法打开，在测试环境中第13代cpu i5-13490F上也无法打开，但是更新openssl组件后可以正常运行。
snipaste自带的openssl组件版本较低，建议升级openssl到对应的1.0.2u版本后再验证其运行情况。可以从以下链接下载1.0.2u版本的libeay32.dll和ssleay32.dll，替换snipaste应用目录下的同名文件。
https://cduc.cmgos.com/download.php?id=1005&token=n57PGnVYZEb6De2ILaKSUmXneuPGLq7Q
您反馈的用户以前可以运行snipaste截图工具，后来发现无法运行，您可以与用户沟通snipaste工具无法运行前后设备硬件和软件环境是否有变化。
针对此问题如果有任何进展或疑问可以回复此邮件。

====第12封邮件====

发件人：Wei Liang
发送时间：2023-06-27 15:39:45.859000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
经过您的同意，我将暂时归档此案例。
工单的归档并不会影响我们为您提供技术支持服务，如有其他问题，您可以随时联系我们。
案例总结：
----
问题定义：
用户反馈在工行环境下无法打开snipaste截图工具，运行时直接退出，需要协助分析，经确认snipaste截图工具在Win7环境下运行正常。
问题总结：
经排查，snipaste截图工具在启动过程中由于0xC0000005（内存访问冲突）错误导致应用无法正常运行。出现0xC0000005错误的组件是snipaste自带的第三方组件openssl的libeay32.dll文件，其版本为1.0.2h，是2016年5月发布的版本。此openssl组件版本较低，可能存在兼容性问题，建议升级openssl到对应的1.0.2u版本后再验证其运行情况。可以从以下链接下载1.0.2u版本的libeay32.dll和ssleay32.dll，替换snipaste应用目录下的同名文件。
https://cduc.cmgos.com/download.php?id=1005&token=n57PGnVYZEb6De2ILaKSUmXneuPGLq7Q
分析处理过程：
通过procdump收集snipaste应用异常退出时的dump文件，dump文件显示由于libeay32!OPENSSL_cleanse操作导致的访问冲突。
Libeay32.dll是第三方组件openssl的文件，其版本为1.0.2h，是2016年5月发布的版本。
此openssl组件版本较低，可能存在兼容性问题，建议升级openssl到对应的1.0.2u版本后再验证其运行情况。
以上，如您后续有任何问题，可随时与我们联系，谢谢。
