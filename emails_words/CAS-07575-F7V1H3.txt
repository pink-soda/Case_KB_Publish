邮件主题：回复: [案例号: CAS-07575-F7V1H3 ] % |P2|ICBC|笔记本关机盒盖系统依然运行问题 % 初次响应 CMIT:0001081

====第1封邮件====

发件人：Wei Liang
发送时间：2022-11-11 18:28:42.083000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
根据您提供的信息，我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
用户反馈有应用阻止系统关机，点击“关机”按钮，关闭笔记本盒盖后系统依然运行，需要协助排查这个问题。
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
如电话中所说，当前采用在计划任务中触发shutdown命令操作，这个计划任务可以运行，请您在最终用户设备上验证这个方案是否可行。
我这边也再进一步查询、验证是否有其他方案可以解决这个问题。

====第2封邮件====

发件人：Wei Liang
发送时间：2022-11-15 17:54:22.787000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
如电话中所说，当前用户未有新的反馈信息，我也会在本地测试是否能有更好的方法实现关机时强制关闭一些应用操作。
如有任何进展，会及时和您联系。

====第3封邮件====

发件人：Wei Liang
发送时间：2022-11-17 10:29:22.106000+00:00
邮件内容:
许先生 您好：
关于应用阻止关机问题解决方法：通过“计划任务”检测到关机事件时，通过shutdown或者taskkill强制关闭应用后，可以正常关机。
在测试环境中测试应用阻止关机情况，使用阻止关机工具shutdownblocker.exe模拟无法关机情况如下：
1）运行shutdownblocker.exe模拟阻止关机，关机时出现以下提示：
此时点击“仍要关机”，此时可以正常结束应用的话，可以正常关机，如果无法结束此应用，系统会长时间停在“正在关机”界面。
2）在出现“仍要关机”界面提示时，查看“事件查看器”中生成的事件。
“应用程序”事件日志：
“系统”事件日志：
3）在测试中发现，在出现“仍要关机”界面提示时，在“计划任务”中配置触发器为“系统”事件（User32：1073、1074）的任务未能正常完成，但配置触发器为“应用程序”事件（Winsrv：10001，Winlogon：4004）的任务正常运行。
针对最终用户的设备的“计划任务”配置，需要查看用户设备上的“应用程序”事件中是否出现了应用阻止关机事件，确认具体的问题所在，再根据此日志记录配置合适的触发器和具体操作。
注：
1）shutdownblocker.exe可以阻止shutdown.exe的关机命令，在测试环境中使用taskkill强制关闭应用。
2）taskkill /f /fi “username eq admin” /im *   （/f 强制关闭应用    /fi “username eq admin”   筛选以用户名admin启动的应用   /im *   指代任意的应用名称）

====第4封邮件====

发件人：Wei Liang
发送时间：2022-11-22 15:06:51.123000+00:00
邮件内容:
许先生 您好：
经过您的同意，我将暂时归档此案例。
工单的归档并不会影响我们为您提供技术支持服务，如您有其他问题，您可以致电技术支持热线4008180055。
案例总结：
----
问题定义：
用户反馈有应用阻止系统关机，点击“关机”按钮，关闭笔记本盒盖后系统依然运行，需要协助排查这个问题。
问题总结：
用户测试通过“计划任务”在关机时触发命令强制结束应用规避此问题，暂时归档案例，如后续需要支持再重启案例。
测试建议：
在“计划任务”检测到关机事件时，通过shutdown或者taskkill强制关闭应用，用户需要注意先保存word等个人应用数据，强制关闭应用会丢失未保存的数据。
1）当执行“关机”操作，但并未正常关机时，查看“事件查看器”中生成的事件。
“应用程序”事件日志：
“系统”事件日志：
2）在测试中发现，在出现“仍要关机”界面提示时，在“计划任务”中配置触发器为“系统”事件（User32：1073、1074）的任务未能正常完成，但配置触发器为“应用程序”事件（Winsrv：10001，Winlogon：4004）的任务正常运行。
针对最终用户的设备的“计划任务”配置，需要查看用户设备上的“应用程序”事件中是否出现了应用阻止关机事件，确认具体的问题所在，再根据此日志记录配置合适的触发器和具体操作。
以上，如您后续有任何问题，可随时与我们联系，谢谢。
