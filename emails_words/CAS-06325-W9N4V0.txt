邮件主题：回复: [案例号: CAS-06325-W9N4V0 ] % |P3|ICBC|关于V0-H系统升级导致IP丢失问题咨询 % 初次响应 CMIT:0001733

====第1封邮件====

发件人：Wei Liang
发送时间：2022-05-26 20:54:02.475000+00:00
邮件内容:
吴先生 您好：
感谢您的电话接听。
根据您提供的信息，我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
咨询V0-H系统升级导致IP丢失的具体情况，操作系统中是否有默认的网卡IP配置规则，以及IP配置所在的注册表位置。
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
一、网卡配置的具体IP信息可以在注册表中查询到，打开注册表编辑器，定位到：
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\<网卡GUID>
针对某块网卡的IP配置，，在其对应的<网卡GUID>的注册表项中主要关注的注册表键值如下：
IP配置
注册表项（自动获取IP）
注册表项（手动配置IP）
1
是否开启DHCP
EnableDHCP=1
EnableDHCP=0
2
IP地址
DhcpIPAddress
IPAddress
3
子网掩码
DhcpSubnetMask
SubnetMask
4
默认网关
DhcpDefaultGateway
DefaultGateway
5
DNS
DhcpNameServer
NameServer
示例中的自动获取 IP配置的注册表如图：
同一块网卡配置手动IP如下：
注意：
虽然注册表中保存了网络IP配置，但是直接通过修改注册表信息去修改IP配置不会立即生效，需要重启网络设备或者直接重启计算机才能生效。
不建议通过修改注册表方式修改IP配置，可以通过IP配置管理界面或者命令行方式修改。
二、V0-H系统升级导致IP丢失的问题，是在操作系统升级切换到NewOS，注册表中IP相关配置信息已经迁移过来，EnableDHCP键值设置为0后，在升级过程中，EnableDHCP键值又被修改为1，但是手动配置IP的其他注册表键值未发生变化，导致IP配置相关的注册表信息不匹配，在操作系统升级后表现为丢失固定IP配置，但是可以通过查询未被修改的注册表键值（如：IPAddress）得到原先的固定IP配置。
三、如果增加一块新的网卡，默认是配置自动获取IP，在注册表中会生成一个新的<网卡GUID>，并在其列表下生成对应的注册表键值，默认设置为：自动获得IP地址，即：EnableDHCP=1，如果网络中有DHCP服务器，则通过DHCP服务器获取相关IP配置。
示例：
新增加一块网卡，以太网3未连接网络：
以太网3通过DHCP获取IP配置：

====第2封邮件====

发件人：Wei Liang
发送时间：2022-05-27 16:17:56.551000+00:00
邮件内容:
吴先生 您好：
刚刚给您电话没有接通。
来信是想咨询当前案件进展状况。上一封邮件的内容是否解答了您的问题？
如果针对当前案件还有需要我们帮助的地方, 欢迎随时联系我们。

====第3封邮件====

发件人：Wei Liang
发送时间：2022-05-30 11:38:32.401000+00:00
邮件内容:
吴先生 您好：
感谢您的电话接听。经过您的同意，我将归档此案例。
工单的归档并不会影响我们为您提供技术支持服务，如您有其他问题，您可以致电技术支持热线4008180055。
案例总结：
----
问题定义：
咨询V0-H系统升级导致IP丢失的具体情况，操作系统中是否有默认的网卡IP配置规则，以及IP配置所在的注册表位置。
问题总结：
一、网卡配置的具体IP信息可以在注册表中查询到，打开注册表编辑器，定位到：
HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Tcpip\Parameters\Interfaces\<网卡GUID>
针对某块网卡的IP配置，，在其对应的<网卡GUID>的注册表项中主要关注的注册表键值如下：
IP配置
注册表项（自动获取IP）
注册表项（手动配置IP）
1
是否开启DHCP
EnableDHCP=1
EnableDHCP=0
2
IP地址
DhcpIPAddress
IPAddress
3
子网掩码
DhcpSubnetMask
SubnetMask
4
默认网关
DhcpDefaultGateway
DefaultGateway
5
DNS
DhcpNameServer
NameServer
注意：
虽然注册表中保存了网络IP配置，但是直接通过修改注册表信息去修改IP配置不会立即生效，需要重启网络设备或者直接重启计算机才能生效。
不建议通过修改注册表方式修改IP配置，可以通过IP配置管理界面或者命令行方式修改。
二、V0-H系统升级导致IP丢失的问题，是在操作系统升级切换到NewOS，注册表中IP相关配置信息已经迁移过来，EnableDHCP键值设置为0后，在升级过程中，EnableDHCP键值又被修改为1，但是手动配置IP的其他注册表键值未发生变化，导致IP配置相关的注册表信息不匹配，在操作系统升级后表现为丢失固定IP配置，但是可以通过查询未被修改的注册表键值（如：IPAddress）得到原先的固定IP配置。
三、如果增加一块新的网卡，默认是配置自动获取IP，在注册表中会生成一个新的<网卡GUID>，并在其列表下生成对应的注册表键值，默认设置为：自动获得IP地址，即：EnableDHCP=1，如果网络中有DHCP服务器，则通过DHCP服务器获取相关IP配置。
以上，如您后续有任何问题，可随时与我们联系，谢谢。
