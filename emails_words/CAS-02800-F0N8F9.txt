邮件主题：回复: 回复：[案例号: CAS-02800-F0N8F9 ] % 北京盛和科技有限公司反馈外管局客户使用Skype出现卡顿现象 %  CMIT:0001703

====第1封邮件====

发件人：Wei Liang
发送时间：2020-08-17 16:23:41.584000+00:00
邮件内容:
胡先生 您好：
根据刚才的电话沟通，我谨在此阐述您所述问题涉及的范围定义：
问题定义：用户出现使用Skype发送消息、传输文件缓慢，语音通话卡顿现象
问题范围：协助用户分析此问题。
如您对以上问题范围定义有任何疑问请直接与我联系。
排查方法：
1、使用文件共享方式测试CMGE系统计算机与安装有Skype Server的服务器之间的文件传输速度，确认计算机与服务器之间文件传输速度情况。
2、使用管理员权限打开Powershell命令行界面，执行以下命令抓取网络数据包：
netsh trace start capture=yes maxsize=500M tracefile=c:\nettrace.etl
3、使用skype操作复现文件传输缓慢和发送文字消息卡顿现象。
4、在powershell命令行中使用以下命令停止抓包：
netsh trace stop
5、在C盘根目录下生成有nettrace.etl和nettrace.cab两个文件，把这两个问题压缩后通过CDUC文件上传系统发送给我们。
文件上传方法：
您可以登陆https://cduc.cmgos.com <https://cduc.cmgos.com/> ，通过数据上传系统上传您所收集的日志信息。如果出现类似错误提示，点击后退即可
用户名：whglj
密码：whglj
注意：添加文件，点击上传后，跳转到新的页面点击保存。
服务电话：400-818-0055

====第2封邮件====

发件人：Wei Liang
发送时间：2020-08-18 17:22:35.665000+00:00
邮件内容:
胡先生 您好：
鉴于用户方面的安全要求，无法提供网络包以及相关日志信息，这边计划搭建skype测试环境，尝试复现用户问题。
需要请您这边提供与用户环境一致版本的软件安装文件和安装说明，用于搭建测试环境。
1、skype server软件安装包
2、skype客户端
3、skype server安装部署文档
对应的文件您可以通过CDUC系统上传。
文件上传方法：
您可以登陆https://cduc.cmgos.com <https://cduc.cmgos.com/> ，通过数据上传系统上传您所收集的日志信息。如果出现类似错误提示，点击后退即可
用户名：whglj
密码：whglj
注意：添加文件，点击上传后，跳转到新的页面点击保存。
服务电话：400-818-0055

====第3封邮件====

发件人：胡贵民
发送时间：2020-08-19 11:20:59.908000+00:00
邮件内容:
您好，客户回复的邮件以附件的形式发给您，如有问题即使联系，也可以把用户的邮件加进来

====第4封邮件====

发件人：胡贵民
发送时间：2020-08-19 13:57:35.034000+00:00
邮件内容:
你好：SKYPE服务器设置为
【Lync Server 2013 5.0.8308.x】
Windows Server 2012 R2 64bit
SQL Server 2012 11.0.2100.60
【Skype for business Server 2015 6.0.9319.x】
Windows Server 2016 STD 64bit
SQL Server 2016 13.1.4001.0

====第5封邮件====

发件人：Wei Liang
发送时间：2020-08-20 18:02:14.168000+00:00
邮件内容:
胡先生 您好：
我这边根据您提供的skype server端安装包搭建了测试环境，未复现用户问题。这边测试情况见附件视频。
下一步计划：
1、建议您在用户环境下，全新安装CMGE系统后，只安装skype客户端，测试是否会出现卡顿情况。
2、在现有的CMGE系统下，卸载第三方软件，只开启skype客户端，测试是否会出现卡顿情况。
服务电话：400-818-0055

====第6封邮件====

发件人：胡贵民
发送时间：2020-08-21 09:14:29.665000+00:00
邮件内容:
您好！非常感谢大家的帮助。为了能更好的让客户对比我们所搭建的SKYPE服务器和客户服务器的一致性，麻烦提供一下我们搭建服务器具体的截图，以及在运行过程中所产生的日志，还有我没有想到的可以证明我们搭建的服务器的具体配置截图。非常感谢。
	------
	
====第7封邮件====

发件人：Wei Liang
发送时间：2020-08-21 13:32:58.117000+00:00
邮件内容:
胡先生 您好：
这边搭建的SKYPE服务器测试环境，安装在一台服务器上，服务器主要硬件配置如下图：
测试环境下的SKYPE服务器配置为标准版，打开Skype For Business Server 2015控制面板，查看相关的配置如下：
服务电话：400-818-0055

====第8封邮件====

发件人：Wei Liang
发送时间：2020-08-24 18:10:29.467000+00:00
邮件内容:
胡先生 您好：
我们准备了以下测试环境要求，麻烦您这边与用户沟通，确认审批通过后，提前准备测试环境。
这边计划优先分析Skype卡顿问题。
针对Skype卡顿，建议提前在用户现场准备以下测试环境，用于问题分析。
1.       用户正常使用的Win7环境，已安装Skype等日常软件，用于软件使用情况对比。
2.       出现问题的CMGE V2020-L环境，在该机器上安装下列工具，用于抓取、分析相关日志，将通过邮件发送软件安装的压缩包。
3.       分别准备一台CMGE V2020-L环境和Win10 Pro 1809环境，在测试机中仅安装下表中列出的软件，其他工具为分析工具，用于抓取、分析相关日志，将通过邮件发送软件安装的压缩包。
4.       另外，排查Skype问题需要在客户端收集日志的同时收集服务器端的日志以便进行网络包分析，以排除卡顿是否与服务器配置有关。
序号
操作系统版本
测试机上需要安装的软件和工具
Skype卡顿
1
Windows 7
无需安装软件或抓取日志，仅作为参考机。
2
现有
CMGE V2020-L
Wireshark
Win10Pcap
Netmon
Procmon
Cmtrace
3
新装纯净
Win10 Pro 1809
Wireshark
Win10Pcap
Netmon
Procmon
Cmtrace
Skype客户端
新装纯净
CMGE V2020-L
Wireshark
Win10Pcap
Netmon
Procmon
Cmtrace
Skype客户端
4
Skype服务器端
运行Netsh命令以收集Skype服务器的网络活动。
针对Office激活问题，建议提前在用户现场准备以下测试环境，用于问题分析。
1.       用户正常使用的Win7环境，已安装ifile等日常软件，用于软件使用情况对比。
2.       出现问题的CMGE V2020-L环境，在该机器上安装下列工具，用于抓取、分析相关日志，将通过邮件发送软件安装的压缩包。
3.       分别准备一台CMGE V2020-L环境和Win10 Pro 1809环境，在测试机中仅安装下表中列出的软件，其他工具为分析工具，用于抓取、分析相关日志，将通过邮件发送软件安装的压缩包。
序号
操作系统版本
测试机上需要安装的软件和工具
提示Office需要激活
1
Windows 7
无需安装软件或抓取日志，仅作为参考机。
2
现有
CMGE V2020-L
Procmon
3
新装纯净
Win10 Pro 1809
Procmon
ifile客户端
新装纯净
CMGE V2020-L
Procmon
ifile客户端
工具下载：
您可以登陆https://cduc.cmgos.com <https://cduc.cmgos.com/> ， 通过数据上传系统选择下载tools.zip  如果出现类似错误提示，点击后退即可
用户名：whglj
密码：whglj
工具说明：
*   Wireshark      网络数据包分析工具。用于抓取和分析网络活动。
*   Win10Pcap    用于Wireshark抓取网络数据包的插件。Wireshark的必需插件。
*   Netmon         解析 netsh trace 获取的ETL网络包。用于分析网络活动。
*   Procmon       系统进程监视工具。用于抓取和分析应用程序和系统进程以了解相关应用的行为是否符合预期。
*   Cmtrace        用于分析Skype客户端的trace log，以了解在发送信息时Skype客户端的行为。（trace log文件位置： %localappdata%\microsoft\office\16.0\lync\tracing\中类似于文件Lync-UccApi-*.UccApilog）

====第9封邮件====

发件人：胡贵民
发送时间：2020-08-25 17:51:10.982000+00:00
邮件内容:
您好：第一：目前客户已经布置了我们要求的环境，明天应该可以完全准备好，麻烦安排周四工程师上门时间。第二：在布置环境时下载-Procmon软件包，软件包里有两个安装程序，客户不知道安装后面带64的还是不带的，麻烦解答一下
	
====第10封邮件====

发件人：胡贵民
发送时间：2020-08-26 13:16:51.490000+00:00
邮件内容:
各位好：关于本次和客户好约时间是明天8月27日9:00，客户地址是：北京市西城区金融街23号平安大厦，到楼下可以打电话陈工：18810826002.会下来接大家。如有问题随时给我打电话：13601263645.明天辛苦大家了。

====第11封邮件====

发件人：Jia Wei
发送时间：2020-08-26 17:24:34.820000+00:00
邮件内容:
Hi Jay,
Performance Monitor数据收集完了，针对这个问题我需要看那个类别去判断是否有资源异常会导致此问题？
另外，netcfg收集出来，发现里面有乱码信息，没法确认具体的内容。单从adapters的名称是否可以判断有三方的软件？
--------------
服务电话： 400-818-0055

====第12封邮件====

发件人：Jay Wang
发送时间：2020-08-26 17:53:46.152000+00:00
邮件内容:
Hi Jiawei，
看下图中cpu0和system进程的几个counter就可以。一般除了idle time其他数值没有异常高的就是正常的。
Netcfg结果里主要看Network Protocols和 Network Services 里有没有非微软的驱动，看不是以ms_前缀的。
Jay Wang | Support Engineer | Windows Commercial | Customer Service & Support
Phone: +86 (510) 66658304 | Email: wang.jay@microsoft.com <mailto:wang.jay@microsoft.com> 
Shift Hours: 9AM - 6PM (UTC+8) Monday to Friday
For any urgent assistance please call your local Microsoft Premier hotline
To deliver customers’ success is always our #1 priority. If you have any feedback on our service, please feel free to contact my manager danzhan@microsoft.com <mailto:danzhan@microsoft.com> 

====第13封邮件====

发件人：Wei Liang
发送时间：2020-08-28 14:00:30.904000+00:00
邮件内容:
胡先生 您好：
通过刚才的电话沟通，简单介绍了昨天我们这边同事去客户现场测试Skype卡顿的情况，总结的测试情况如下：
案例背景：中央外汇管理局客户，反应使用Skype发送信息时卡顿，但发送附件正常。
客户环境：3个用户账户使用Skype 2016 Server，今日测试的账户均接入Lync 2013 Server。
案例分析：
1）使用只安装Skype的CMGE V2020-L和Windows 10 Pro 1909均未复现问题。基本排除操作系统原因造成卡顿；
2）确定固定复现场景：
*       打开word / outlook / access等，例如word建立文档输入任意字符，同时单击Skype for Business 2016对话窗口，输入字符后回车发送，Skype发生类似假死状态，字符大概5-10秒从发送窗口消失，但上方对话窗口未出现输入的字符，同时光标不闪烁，点击其他Skype界面均没有响应，鼠标为输入字符时的光标图像；
*       等待大概1分钟左右，发送信息成功，但点击Skype任何界面部分仍呈现假死状态；
*       关闭Word文档，等待约1-2分钟，卡顿现象消失，此时输入任何字符发送均无卡顿；
3）使用安装全部用户三方软件的CMGE V2020-L和Windows 10 Pro 1909均可以复现问题；
案例结果：经过排查，发现登陆亿赛通电子文档安全管理系统后，可以固定复现Skype发送消息卡顿现象。
软件信息：亿赛通电子文档安全管理系统 版本：5.2.0
通过以上的测试情况可以确认，用户现场出现的Skype卡顿情况与操作系统无关。
服务电话：400-818-0055

====第14封邮件====

发件人：Jia Wei
发送时间：2020-08-28 14:48:49.384000+00:00
邮件内容:
Hi Jay,
谢谢您的电话和邮件支持，目前定位到问题原因，此案例可以先关闭了。
再次感谢。
--------------
服务电话： 400-818-0055

====第15封邮件====

发件人：Jay Wang
发送时间：2020-08-28 15:49:13.597000+00:00
邮件内容:
Hi Jiawei,
感谢反馈，如电话沟通，由于问题已经定位到是三方软件造成的，我会关闭该case。如还有疑问欢迎联系我。
再次感谢联系微软技术支持，希望您能对我的服务满意。
以下是case总结：
问题描述
==========
Win10 上skype输入文字敲回车后skype夯住
问题原因
=========
三方文档管理系统造成skype hang
此类问题的排查手段分享
========================
目前遇到的问题为三方软件导致应用使用出现卡顿，常规的我们可以使用如下工具或方法进行分析：
1）    抓取问题时刻进程对应的user dump。结合callstack查看问题时刻是否有三方软件驱动在影响当前应用
2）  使用process monitor日志抓取一段时间问题时刻log。尝试分析应用进程当时load的驱动以及相关的callstack。
同时根据对当前应用工作逻辑的理解，查看当前系统层面是否有可能影响应用工作的行为，比如block应用依赖的配置文件等。 
3）在排查问题时，可以使用cleanboot，同时根据二分法的方式，对三方软件驱动进行批量隔离。
Jay Wang | Support Engineer | Windows Commercial | Customer Service & Support
Phone: +86 (510) 66658304 | Email: wang.jay@microsoft.com <mailto:wang.jay@microsoft.com> 
Shift Hours: 9AM - 6PM (UTC+8) Monday to Friday
For any urgent assistance please call your local Microsoft Premier hotline
To deliver customers’ success is always our #1 priority. If you have any feedback on our service, please feel free to contact my manager danzhan@microsoft.com <mailto:danzhan@microsoft.com> 

====第16封邮件====

发件人：Wei Liang
发送时间：2020-08-31 15:14:33.692000+00:00
邮件内容:
胡先生 您好：
如刚才的电话沟通，我将归档此案例。
工单的归档并不会影响我们为您提供技术支持服务，如您有其他问题，您可以致电技术支持热线4008180055。
案例总结：
----
问题定义：
用户出现使用Skype发送消息、语音通话卡顿现象
问题分析：
在客户现场排查，在V2020-L与Win10 1909系统上只安装Skype未发现卡顿问题，确认Skype卡顿问题与操作系统无关。
后续一步步安装用户的三方软件，在登录亿赛通电子文档安全管理系统，并打开word/excel等软件时，使用Skype出现卡顿现象，定位到登录亿赛通电子文档安全管理系统后，可以复现Skype卡顿现象。
问题总结：
定位到是由第三方软件亿赛通电子文档安全管理系统造成Skype卡顿，需要第三方软件厂商处理。
服务电话：400-818-0055
