邮件主题：回复: [案例号: CAS-05131-V6L7R2 ] % 售前反馈招商银行智能卡库及实时制卡机应用问题 % 初次响应 CMIT:0001120

====第1封邮件====

发件人：Wei Liang
发送时间：2021-11-19 16:04:45.470000+00:00
邮件内容:
汪先生 您好：
感谢您的电话接听。
我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
普通用户（Users组权限）登录时自动运行智能卡库及实时制卡机应用，应用运行后到激活卡步骤时出现问题（问题现象为黑屏，应用进程被关闭）。
自动运行应用是通过修改注册表配置方式实现。
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
信息收集：
1、请您提供配置自动启动应用的注册表信息截图和注册表路径；
2、请您在同一台设备上拍摄视频：
（1）        拍摄以普通用户权限双击启动应用的视频（从应用启动到可以正常使用状态的过程）；
（2）        拍摄以普通用户权限自动启动应用的视频（从应用启动到出错退出的过程）。
3、下载附件中的procmon.zip文件，使用procmon工具收集在普通用户登录后双击应用运行正常时的procmon日志，以及配置自动运行应用时的procmon日志。具体收集方法如下：
3.1  收集普通用户登录后双击应用运行正常时的procmon日志
a）双击procmon.exe运行，点击Accept后，到达此页面，会有有大量条目出现，先后点击1，2暂停抓取并清除当前条目。当前已经是可抓取状态；
b）点击下图的图标开始抓取。
c）双击运行“智能卡库及实时制卡机应用”，确认应用加载完成，到可以正常运行状态。
d）此时回到Process Monitor窗口，单击Capture图标，停止抓取；
e）点击File, 点击Save. 选择"All events" and "Native Process Monitor Format (PML)"点击OK。记录文件保存位置； 
f）将PML文件重命名为“运行正常日志”、打包压缩。
3.2  收集以普通用户登录自动运行应用时的procmon日志。
a）在测试机上新建两个用户A和B，A用户为管理员权限， B用户为Users权限，通过注册表配置用户登录自动运行智能卡库及实时制卡机应用。
b）使用用户A登录，（此时可能出现自动运行智能卡库及实时制卡机应用，等待应用运行完成后选择退出此应用）。
c）打开任务管理器，选择“文件”-“运行新任务”，新建任务指定procmon.exe的路径，运行procmon.exe
d）到达此页面，会有有大量条目出现，先后点击1，2暂停抓取并清除当前条目。当前已经是可抓取状态；
e）点击下图的图标开始抓取。
f）通过“Ctrl+Alt+Del”组合键选择“切换用户”，此时使用B用户登录，等待自动运行智能卡库及实时制卡机应用，运行到出错退出后。
g）此时通过“Ctrl+Alt+Del”组合键选择“切换用户”，选择A用户登录，回到Process Monitor窗口，单击Capture图标，停止抓取；
h）点击File, 点击Save. 选择"All events" and "Native Process Monitor Format (PML)"点击OK。记录文件保存位置； 
i）将PML文件重命名为“运行报错日志”、打包压缩。
4、收集操作系统相关日志信息：
下载附件中的CMGELogCollector.zip，解压后运行，勾选全部选项，点击“收集”，运行几分钟后会在桌面生成日志压缩包。
将上述操作收取的日志压缩后，通过CDUC上传。
日志上传方法：
您可以登陆https://cduc.cmgos.com <https://cduc.cmgos.com/> ，通过数据上传系统上传您所收集的日志信息。如果出现类似错误提示，点击后退即可。
用户名：cmbchina
密码：cmbchina
注意：添加文件，点击上传后，跳转到新的页面点击保存。

====第2封邮件====

发件人：Wei Liang
发送时间：2021-11-19 16:35:10.711000+00:00
邮件内容:

====第3封邮件====

发件人：/o=cmit/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=807fa5656370439798265da97487f407-Zou Jing
发送时间：2021-11-23 11:00:02.280000+00:00
邮件内容:
这个CASE目前有更新吗？招行客户给收日志了吗？

====第4封邮件====

发件人：Wei Liang
发送时间：2021-11-23 11:40:43.970000+00:00
邮件内容:
Hi ZouJing：
经与汪涛联系沟通，有如下更新：
1)       日志已经收集完成，由于安全合规要求，不能传出相关日志；
2)       经沟通，汪涛会上传提供问题现象视频；
3)       与设备厂商直接联系测试操作需要通过汪涛确认，不能直接联系设备厂商技术人员。
我们首先会通过视频尽量提供一些建议，进一步的建议还是需要通过分析日志后才能提供。

====第5封邮件====

发件人：Wei Liang
发送时间：2021-11-23 14:20:25.042000+00:00
邮件内容:
Hi ZouJing：
再更新一下当前案例的进展：
1)       在电话沟通中了解到用户采用修改注册表 winlogon shell方式实现应用自动运行。
2)       期间建议用户测试采用其他自启方式，如计划任务等方式测试应用自动启动运行情况，用户表示只能使用这种方法设置应用自启动，未接受此测试方案。
请售前协调是否能从用户处拿到日志，谢谢。

====第6封邮件====

发件人：Wei Liang
发送时间：2021-11-23 17:33:35.342000+00:00
邮件内容:
汪先生 您好：
根据您提及的采用注册表winlogon shell方式配置智能卡库及实时制卡机应用自启动的方法，我做了一些测试，发现这种自启动方式是在用户登录时，由userinit.exe第一时间启动配置的应用。
结合您所说的双击运行智能卡库及实时制卡机应用可以正常使用，请您进行以下测试，验证exploer.exe进程（Windows桌面应用）和不同的应用自启动方式对这个问题是否有影响。
1）配置应用自启动时一块启动explorer.exe进程，显示Windows桌面，确认此时应用运行情况。
2）采用计划任务方式配置应用自启动，确认应用运行情况，具体配置如下：
a）打开计划任务程序，添加计划任务，右键选择创建任务，指定运行任务的用户帐户；
b）配置触发器选择开始任务选择“登录时“，指定特定的用户运行，您还可以在这里配置“延迟任务时间”，等待系统服务完全启动后再运行应用；
c）在操作中指定智能卡库及实时制卡机应用。
我看到了您通过CDUC上传了应用运行的视频，我下载后无法播放，查看CDUC上的视频文件大小显示为0 Byte。
麻烦您把这些视频先打包压缩后，再次上传，谢谢。

====第7封邮件====

发件人：Wei Liang
发送时间：2021-11-24 17:34:49.174000+00:00
邮件内容:
汪先生 您好：
感谢您的电话接听。
与您的沟通情况总结如下：
1)       自启动应用运行后，在做激活卡操作时，应用自动退出。
2)       自启动应用退出问题已经请应用组人员分析过，未找到原因，应用组人员建议请系统厂商协助分析。
3)       这个问题在Windows 10 1809专业版上也复现。
4)       根据我们的建议，测试在启动Windows桌面环境（explorer.exe）时自启动应用，问题复现。
5)       根据我们的建议，测试使用其他方案配置应用自启动（如：计划任务配置应用自启动），问题复现。
据您的反馈，上一封邮件提供的日志收取过程对应用复现问题有影响，我重新整理了新的日志收取步骤，请您按照新的操作步骤收集日志。
一、收集普通用户登录后双击应用运行正常时的procmon日志
a）双击procmon.exe运行，点击Accept后，到达此页面，会有有大量条目出现，先后点击1，2暂停抓取并清除当前条目。当前已经是可抓取状态；
b）点击下图的图标开始抓取。
c）双击运行“智能卡库及实时制卡机应用”，确认应用加载完成，到可以正常运行状态。
d）此时回到Process Monitor窗口，单击Capture图标，停止抓取；
e）点击File, 点击Save. 选择"All events" and "Native Process Monitor Format (PML)"点击OK。记录文件保存位置； 
f）将PML文件重命名为“运行正常日志”、打包压缩。
二、收集以普通用户登录自动运行应用时的procmon日志。
a）在测试机上通过注册表配置用户登录自动运行智能卡库及实时制卡机应用。
b）使用管理员权限用户A登录，（此时可能出现自动运行智能卡库及实时制卡机应用，等待应用运行完成后选择退出此应用）。
c）打开任务管理器，选择“文件”-“运行新任务”，新建任务指定procmon.exe的路径，运行procmon.exe
d）到达此页面，会有有大量条目出现，先后点击1，2暂停抓取并清除当前条目。当前已经是可抓取状态；
e）选择Optinos，勾选Enable Boot Logging，配置此设置后，关闭procmon。
f）通过“Ctrl+Alt+Del”组合键选择“注销”，回到用户登录界面。
g）在用户登录界面，选择右下角的电源按钮选择“重启”。
h）等待系统重启后，使用普通用户权限B登录，等待自动运行智能卡库及实时制卡机应用，运行到出错退出后。
i）此时通过“Ctrl+Alt+Del”组合键选择“打开任务管理器”，选择“文件”-“运行新任务”，新建任务指定procmon.exe的路径，打开procmon应用，此时会提示保存procmon日志。
j）选择合适的位置保存日志，将日志文件重命名为“运行报错日志”、打包压缩，通过CDUC上传。

====第8封邮件====

发件人：Wei Liang
发送时间：2021-11-24 17:48:37.691000+00:00
邮件内容:
Hi ZouJing：
查看问题视频，并与汪涛联系沟通确认，有如下更新：
1)       自启动应用运行后，在做激活卡操作时，应用自动退出。
2)       自启动应用退出问题已经请应用组人员分析过，未找到原因，应用组人员建议请系统厂商协助分析。
3)       这个问题在Windows 10 1809专业版上也复现。
4)       根据我们的建议，测试在启动Windows桌面环境（explorer.exe）时自启动应用，问题复现。
5)       根据我们的建议，测试使用其他方案配置应用自启动（如：计划任务配置应用自启动），问题复现。
与汪涛沟通解释了收取日志的作用，根据汪涛的反馈，上一次的日志收取过程对应用复现问题有影响，重新整理了新的日志收取步骤，已经发送给汪涛。
当前情况已经无法提供进一步的测试建议，只能通过日志分析排查问题，请您帮忙协调沟通获取相关日志。

====第9封邮件====

发件人：Wei Liang
发送时间：2021-11-25 16:51:44.108000+00:00
邮件内容:
Hi ZouJing：
与汪涛联系沟通确认，有如下更新：
1)       用户当前任务繁忙，未测试新的日志收集方法。
2)       用户说招行领导想要知道出现这个问题的原因，而不是做各种测试去确认不同场景下的应用运行情况。
3)       收集的日志由于安全合规要求无法提供。
我会尽量提供一些可能的测试建议；但是招行想要知道问题原因，只能通过分析日志排查，请您帮忙协调沟通获取相关日志。

====第10封邮件====

发件人：/o=cmit/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=807fa5656370439798265da97487f407-Zou Jing
发送时间：2021-11-25 16:55:33.316000+00:00
邮件内容:
你邮件发给招行汪涛，CC给他们陈工  ，说明一下我们没有日志无法进行进一步分析。 

====第11封邮件====

发件人：Wei Liang
发送时间：2021-11-25 17:05:37.313000+00:00
邮件内容:
汪先生 您好：
感谢您的电话沟通。
针对智能卡库及实时制卡机应用自启动后，运行到激活卡步骤时自动退出的问题，想要了解发生这个问题的具体原因，只能通过日志分析应用的运行过程，尝试发现问题点。
当前您无法提供具体日志，那只能测试不同的场景下的应用运行情况，尝试找出能规避问题的场景。
根据您提供的使用winlogon shell方式配置应用自启动，我发现使用管理员权限配置完成后，直接重启计算机，使用普通用户登录，此时应用自动启动，但是在任务管理器中还有另一个相同的应用进程。
为排除同一个应用启动两个进程的影响，建议您做以下设置后再次测试并收集应用日志：
为每一个用户做如下配置，在“设置”-“帐户”-“登录选项”页，关闭“更新或重启后，使用我的登录信息自动完成设备设置并重新打开我的应用。”

====第12封邮件====

发件人：Wei Liang
发送时间：2021-11-25 17:18:30.454000+00:00
邮件内容:
Hi ZouJing：
在与汪涛的电话沟通中已经多次说明没有日志无法进行下一步分析。
沟通的具体内容已通过邮件发送给招行，并且强调了只能通过日志去分析问题原因。
请您帮忙协调沟通获取相关日志。

====第13封邮件====

发件人：Wei Liang
发送时间：2021-11-29 11:11:53.823000+00:00
邮件内容:
汪先生 您好：
来信是想咨询当前案件进展状况。
在“设置”-“帐户”-“登录选项”页，关闭“更新或重启后，使用我的登录信息自动完成设备设置并重新打开我的应用”功能后，再使用procmon配置boot logging收取自启动应用运行的日志情况如何？
当前情况只能通过日志分析应用的运行过程，尝试发现问题点，没有日志无法进行下一步分析。
如果针对当前案件还有需要我们帮助的地方, 欢迎随时联系我们。

====第14封邮件====

发件人：121068049
发送时间：2021-11-29 14:08:48.416000+00:00
邮件内容:
危先生，您好
      感谢跟进，但是因为信息安全问题，我们日志转发不出来，希望贵司能来现场定位
--- 原始邮件 ---

====第15封邮件====

发件人：Wei Liang
发送时间：2021-11-29 16:37:11.114000+00:00
邮件内容:
Hi ZouJing：
与招行陈老师联系沟通确认，有如下更新：
1)       由于信息安全原因，用户无法提供日志。
2)       用户近期会讨论是否继续处理这个问题，有结果后会联系我们是否继续处理。
我计划这周四再次联系客户，在此期间如您收到了用户的信息反馈需要继续处理此问题，请您及时告诉我。

====第16封邮件====

发件人：/o=cmit/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=807fa5656370439798265da97487f407-Zou Jing
发送时间：2021-11-29 16:38:46.491000+00:00
邮件内容:
收到，感谢反馈案例进度。

====第17封邮件====

发件人：Wei Liang
发送时间：2021-12-02 14:50:50.834000+00:00
邮件内容:
Hi ZouJing：
如上午沟通确认，我将暂时归档此案例。
工单的归档并不会影响我们为您提供技术支持服务，如您有其他问题，您可以致电技术支持热线4008180055。
案例总结：
----
问题定义：
普通用户（Users组权限）登录时自动运行智能卡库及实时制卡机应用，应用运行后到激活卡步骤时出现问题（问题现象为黑屏，应用进程被关闭）。
自动运行应用是通过修改注册表配置方式实现。
问题总结：
用户需要讨论是否继续处理这个问题，当前暂时归档案例。
测试建议：
一、为排除同一个应用启动两个进程的影响，建议您做以下设置后，再次测试并使用procmon工具收集应用日志：
为每一个用户做如下配置，在“设置”-“帐户”-“登录选项”页，关闭“更新或重启后，使用我的登录信息自动完成设备设置并重新打开我的应用。”
二、取消注册表方式配置自启动，使用计划任务方式配置应用自启动，确认应用运行情况。
以上，如您后续有任何问题，可随时与我们联系，谢谢。
