邮件主题：回复: 回复： [案例号: CAS-03764-S9L7V5 ] % |P2|ICBC|使用管理员用户注册OCX控件后普通用户桌面无法显示 % 初次响应 CMIT:0001600

====第1封邮件====

发件人：Jia Wei
发送时间：2021-02-03 11:20:00.821000+00:00
邮件内容:
阮女士 您好, 
根据之前的讨论, 我谨在此阐述我们双方针对这个问题所涉及范围界定： 
问题定义: 
1）使用本地管理员权限账号登录，安装插件。2）添加注册表权限。3）使用普通域用户权限账户登录，发现桌面图标变成白色，无法打开，打开有报错
使用本地管理员创建的其他管理员，安装插件没有遇到此问题。
在外网环境没有遇到此问题，ICBC域环境内出现此问题
问题范围: 
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。 
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。 
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。 
信息收集：
为了尽可能在我的本地环境复现您的问题现象，以便进一步定位问题原因，还需要您提供如下信息：
一、问题现象的视频、截图或照片。
二、详细的问题复现步骤，及电话沟通中涉及的具体操作。
三、使用工具进行日志收集。
1）首先，在计算机上下载附件CMGELogCollector.zip文件并解压到本地磁盘，在有问题的计算机上进行如下操作收集日志：再双击运行exe文件，同意后，按照下图勾选系统日志，组策略信息、网络信息、软件信息，系统进程、已安装补丁，点击收集。 
2）收集完毕后将在当前用户桌面生产CMGE_Log。点击确定，将直接打开文件夹并定位压缩文件。 
3）将压缩文件上传。
文件上传：
您可以登陆https://cduc.cmgos.com <https://cduc.cmgos.com/> ，通过数据上传系统上传您所收集的日志信息。如果登录不成功，点击后退即可
用户名：ICBC001
注意，
--------------

====第2封邮件====

发件人：Jia Wei
发送时间：2021-02-03 14:49:26.841000+00:00
邮件内容:
阮女士 您好,
收到您的反馈邮件和信息，我将尽快进行处理。
如果有问题或进展我将与您取得联系。
--------------

====第3封邮件====

发件人：Jia Wei
发送时间：2021-02-03 17:46:40.935000+00:00
邮件内容:
阮女士，您好
======
上封邮件内容：
第一部分：
本地管理员权限账号（域用户）安装插件步骤为：
1. 打开注册表，右键HKEY_CLASSES_ROOT选择权限，在打开的对话框中添加当前默认管理员域用户，并允许“完全控制”权限
2. 右键插件选择以管理员权限安装
3-1. 切换至普通用户账户（域用户）查看插件是否能使用-出现图标变白、无法打开管理等功能的问题
3-2. 切换至其他管理员账户（域用户）时，一切正常，可以使用插件
第二部分：
添加新增管理员（域用户）：
1. 点击右下角图标，点击用户头像选择更改账户设置
2. 选择“其他人员”，点击“添加工作单位或学校用户”输入域用户账户信息，添加为管理员
新增管理员账户（域用户）安装插件步骤为：
1. 右键插件选择以管理员权限安装
2. 切换至普通用户账户（域用户）查看插件是否能使用-正常，可以使用
注册表如下路径中存在对应信息时，切换至普通用户登录即可使用插件
=======
案例分析：
目前您提到的2个问题，我在本地测试但都没有复现。
问题1：使用本地管理员权限账号（域用户）直接安装插件时，无法写入注册表HKCR\Wow6432node\Typelib\...，需要在HKCR中添加当前账号并赋予“完全读写”权限，再手动添加注册表项。
本地测试过程：使用本地管理员权限账号（域用户）直接安装插件，可以找到注册表项HKCR\Wow6432node\Typelib\...。所以成功安装插件，无需单独添加权限。
问题2：安装插件完毕，切换至普通用户账户（域用户），查看插件是否能使用-出现图标变白、无法打开管理等功能的问题
本地测试过程：安装插件完毕，切换至普通用户账户（域用户），未出现“图标变白、无法打开管理等功能”现象
综合上述测试结果，和您关于此问题的描述，我怀疑问题可能与用户权限有关。
第一部分中的账号：本地管理员权限账号（域用户）与第二部分中：新增管理员账户（域用户），两个都是安装插件的账号，但结果却不一致：
1）使用本地管理员权限账号（域用户）安装插件出错，还需要手动更改注册表权限，之后切换其他普通域用户出现问题现象。
2）而新增管理员账户（域用户）则可以直接安装成功，后续切换其他普通域用户未出现问题现象。
接下来可以查看这两个账号的权限的差异。
建议操作：
一、收集权限信息
分别使用第一部分中：本地管理员权限账号（域用户）和第二部分中：新增管理员账户（域用户）登录
1）运行cmd；
2）运行命令
Whoami /all >> %userprofile%\desktop\1.txt
3）将桌面生成的1.txt文档按照不同用户名进行重命名，并上传
二、安装最新系统更新
由于您当前安装的是2020-05的累计更新，建议安装行内最新的累计更新补丁，再查看问题是否有所缓解。
三、建议将当前测试用户/计算机划转至单独的测试OU，测试使用系统默认组策略的情况下，问题是否出现。
四、您是否可以抓取并提供此问题计算机当前运行系统的镜像文件，以供我本地测试缓解按照、测试？
文件上传：
您可以登陆https://cduc.cmgos.com <https://cduc.cmgos.com/> ，通过数据上传系统上传您所收集的日志信息。如果登录不成功，点击后退即可
用户名：ICBC001
注意，
--------------

====第4封邮件====

发件人：Jia Wei
发送时间：2021-02-04 11:15:59.472000+00:00
邮件内容:
阮女士，您好
您电话中提到的，通过上封邮件的方法可以正常按照插件而无需手动更改、添加注册表项。我怀疑此问题与用户权限有关，您可以按照之前邮件操作反馈权限日志。
关于UAC用户账户控制，我找到了如下相关材料，希望对您有所帮助：
用户帐户控制 (UAC) 有助于防止恶意软件损坏电脑，并且有助于组织部署易于管理的桌面。借助 UAC，应用和任务将始终在非管理员帐户的安全上下文中运行，除非管理员专门授予管理员级别的访问系统权限。 UAC 可阻止自动安装未经授权的应用并防止意外更改系统设置。
UAC 中的管理员批准模式有助于防止恶意软件在管理员不知情的情况下静默安装。 它还有助于防止意外的系统范围的更改。 最后，它可以用于强制执行更高级别的合规性，其中管理员必须主动同意或为每个管理进程提供凭据。
检查 UAC 滑块级别
UAC 有一个滑块，可从四个级别的通知中进行选择。
*         始终通知将：
*         当程序尝试安装软件或对计算机进行更改时通知您。
*         对 Windows 设置进行更改时通知您。
*         冻结其他任务，直到做出响应。
如果你经常安装新软件或访问不熟悉的网站，建议使用此程序。
*         仅当程序尝试对我的计算机进行更改时通知我：
*         当程序尝试安装软件或对计算机进行更改时通知您。
*         对 Windows 设置进行更改时不发出通知。
*         冻结其他任务，直到做出响应。
如果你不经常安装应用或访问不熟悉的网站，建议使用此方法。
*         仅当程序尝试对我的计算机进行更改时通知我（不要使我的桌面变暗）：
*         当程序尝试安装软件或对计算机进行更改时通知您。
*         对 Windows 设置进行更改时不发出通知。
*         不会冻结其他任务，直到你作出响应。
不建议使用。 仅在需要很长时间才能使计算机上的桌面变暗时，才选择此项。
*         从不通知（禁用 UAC 提示）将：
*         当程序尝试安装软件或对计算机进行更改时，不会通知您。
*         对 Windows 设置进行更改时不发出通知。
*         不会冻结其他任务，直到你作出响应。
出于安全考虑，建议不要使用。
滑块永远不会完全关闭 UAC。 如果将它设置为"从不通知"，它将：
*         使 UAC 服务保持运行。
*         导致管理员启动的所有提升请求自动获得批准，而不显示 UAC 提示。
*         自动拒绝标准用户的所有提升请求。
--------------

====第5封邮件====

发件人：Jia Wei
发送时间：2021-02-04 14:36:08.584000+00:00
邮件内容:
阮女士，您好
刚刚电话未能联系到您。我对比了2个权限日志，2个账号对应的所在组是完全一致的。
此外，经过调查对应UAC相关设置，是ICBC镜像定制项策略之一，在ICBC镜像定制项中已经将UAC禁用。您可以通过如下方法将启用UAC。
1）同时按下Windows+R键，运行gpedit.msc；
2）到计算机配置 – Windows设置 – 安全设置 – 本地策略 – 安全选项，将用户账户控制：以管理员批准模式运行所有管理员，改为已启用。
--------------

====第6封邮件====

发件人：Jia Wei
发送时间：2021-02-05 10:40:07.444000+00:00
邮件内容:
阮女士 您好!
很高兴与您电话沟通，根据沟通的结果，我将暂时归档此问题。案例归档后您会收到调查问卷的邮件，希望可以对我们的服务进行评价。 
工单的归档并不会影响我们为您提供技术支持服务，如果您的问题复现，或有新的问题出现，您也可以致电我们的技术支持热线4008180055。
案例总结：
案例描述：
第一部分：
本地管理员权限账号（域用户）安装插件步骤为：
1. 打开注册表，右键HKEY_CLASSES_ROOT选择权限，在打开的对话框中添加当前默认管理员域用户，并允许“完全控制”权限
2. 右键插件选择以管理员权限安装
3-1. 切换至普通用户账户（域用户）查看插件是否能使用-出现图标变白、无法打开管理等功能的问题
3-2. 切换至其他管理员账户（域用户）时，一切正常，可以使用插件
第二部分：
添加新增管理员（域用户）：
1. 点击右下角图标，点击用户头像选择更改账户设置
2. 选择“其他人员”，点击“添加工作单位或学校用户”输入域用户账户信息，添加为管理员
新增管理员账户（域用户）安装插件步骤为：
1. 右键插件选择以管理员权限安装
2. 切换至普通用户账户（域用户）查看插件是否能使用-正常，可以使用
注册表如下路径中存在对应信息时，切换至普通用户登录即可使用插件
建议操作：
一、收集权限信息
分别使用第一部分中：本地管理员权限账号（域用户）和第二部分中：新增管理员账户（域用户）登录
1）运行cmd；
2）运行命令
Whoami /all >> %userprofile%\desktop\1.txt
3）将桌面生成的1.txt文档按照不同用户名进行重命名，并上传
二、安装最新系统更新
由于您当前安装的是2020-05的累计更新，建议安装行内最新的累计更新补丁，再查看问题是否有所缓解。
三、建议将当前测试用户/计算机划转至单独的测试OU，测试使用系统默认组策略的情况下，问题是否出现。
四、您是否可以抓取并提供此问题计算机当前运行系统的镜像文件，以供我本地测试缓解按照、测试？
案例进展：
用户使用临时解决方案，可以正常安装：
1. 在默认管理员账户（域用户） 下开启用户账户控制（默认为关闭）
2. 右键以管理员权限安装插件
3. 关闭用户账户控制
4. 切换至普通用户（域用户）测试，插件可正常使用，无图标变白问题
--------------
