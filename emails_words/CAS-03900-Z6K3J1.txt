邮件主题：回复: Re:回复: Re:回复: 回复：[案例号: CAS-03900-Z6K3J1 ] % |P2|ICBC|OCR无法在IE识别 % 初次响应 CMIT:0001898

====第1封邮件====

发件人：Li Qi
发送时间：2021-03-15 10:45:42.460000+00:00
邮件内容:
张先生，您好：
根据之前的讨论, 我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
用户反馈OCR应用在IE下存在不能识别的问题，经查因发现，系CMGE下，英文字符点阵颜色不纯造成,原win7正常纯色
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
请您如电话所述，明确如下信息，方便接下来的问题排查：
1， 明确问题电脑的系统版本，具体方法如下：
按Win+R，在运行窗口中输入“winver”
2， 提供颜色不纯的具体对比图像。如可能，请告知可以在本地复现您所述问题的具体步骤。
3， 请描述下该问题对工行具体业务的business impact及紧急程度。

====第2封邮件====

发件人：Li Qi
发送时间：2021-03-19 14:25:23.409000+00:00
邮件内容:
张先生，您好：
感谢您的大力支持。收到您的截图后，我在本地对此问题也进行了复现。其问题与您最初的问题描述有些不符，主要表现为IE8和IE11在非汉字部分的渲染均有杂色或灰度像素点；而汉字部分的渲染结果不一致，IE8纯色显示，IE11有杂色或灰度像素点。
目前的测试步骤与结果如下：
在Win7-IE8和Win10-IE11上设置相同的显示字体
同样访问www.baidu.com <http://www.baidu.com> ，并在首页内容中找到非汉字和汉字的内容，使用放大镜工具进行观察。可以看到非汉字部分均有杂色或灰度像素点。而汉字部分的渲染结果不同，Win7-IE8是纯色显示；Win10-IE11有杂色或灰度像素点。具体可参见下图：
       Win7-IE8的非汉字显示:
        Win10-IE11的非汉字显示:
Win7-IE8的汉字显示：
       Win10-IE11的汉字显示:
基于上述结果，接下来对此问题的处理范围定义更新如下：
问题定义:
在IE11使用“网页字体：SimSun-ExtB；纯文体字体：黑体”的设置下，网页渲染的汉字字体为杂色或有灰度像素点，与IE8的表现不符。非汉字字体与IE8的表现一致，均为杂色或有灰度像素点。
问题范围:
我们将协助您分析处理汉字字体部分的问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
目前已测试的内容为：
将www.baidu.com加入本地intranet站点，尝试使用IE8的文字渲染方式进行页面渲染，问题依旧
通过F12修改文档模式至IE8，问题依旧
因此如之前电话所述，目前大概率判断为IE11对汉字渲染部分进行的变更导致，接下来，我将在内部进行查询相关变更内容的影响，如有更新，我会第一时间与您联系，感谢您的大力配合。

====第3封邮件====

发件人：张杰
发送时间：2021-03-19 14:39:18.515000+00:00
邮件内容:
谢谢李工支持👍，不过百度不目标网站，而且win10对汉字的内外网结果又不同（内网汉字全纯色），我还是申请下，考虑将内网的HTML发您分析吧，毕竟有针对性解决问题是需求。
                                      张杰
                                   2021.3.19
________________________________
发自 网易邮箱大师 <https://mail.163.com/dashi/dlpro.html?from=mail81>  
	在2021年03月19日 14:25，Li Qi <mailto:liqi@cmgos.com>  写道：
	张先生，您好：
	感谢您的大力支持。收到您的截图后，我在本地对此问题也进行了复现。其问题与您最初的问题描述有些不符，主要表现为IE8和IE11在非汉字部分的渲染均有杂色或灰度像素点；而汉字部分的渲染结果不一致，IE8纯色显示，IE11有杂色或灰度像素点。
	目前的测试步骤与结果如下：
	在Win7-IE8和Win10-IE11上设置相同的显示字体
	同样访问www.baidu.com <http://www.baidu.com> ，并在首页内容中找到非汉字和汉字的内容，使用放大镜工具进行观察。可以看到非汉字部分均有杂色或灰度像素点。而汉字部分的渲染结果不同，Win7-IE8是纯色显示；Win10-IE11有杂色或灰度像素点。具体可参见下图：
	       Win7-IE8的非汉字显示:
	        Win10-IE11的非汉字显示:
	Win7-IE8的汉字显示：
	       Win10-IE11的汉字显示:
	基于上述结果，接下来对此问题的处理范围定义更新如下：
	问题定义:
	在IE11使用“网页字体：SimSun-ExtB；纯文体字体：黑体”的设置下，网页渲染的汉字字体为杂色或有灰度像素点，与IE8的表现不符。非汉字字体与IE8的表现一致，均为杂色或有灰度像素点。
	问题范围:
	我们将协助您分析处理汉字字体部分的问题，并对定义的问题给予最大的技术支持。
	如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
	接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
	目前已测试的内容为：
	将www.baidu.com加入本地intranet站点，尝试使用IE8的文字渲染方式进行页面渲染，问题依旧
	通过F12修改文档模式至IE8，问题依旧
	因此如之前电话所述，目前大概率判断为IE11对汉字渲染部分进行的变更导致，接下来，我将在内部进行查询相关变更内容的影响，如有更新，我会第一时间与您联系，感谢您的大力配合。
	
====第4封邮件====

发件人：Li Qi
发送时间：2021-03-19 15:45:03.289000+00:00
邮件内容:
张先生，您好：
好的。感谢您的回复。如可以将应用OCR控件的内网HTML页面发送给我，我将进行同样的测试，即
a)       加载OCR控件后的内网HTML在Win7-IE8的汉字显示：
b)       加载OCR控件后的内网HTML在Win10-IE11的汉字显示:
如无法发送给我的话，请您进行上述两个场景的测试并截图。
如上述两个测试结果不同，我将按照这组对比结果进行排查。请知晓，谢谢。

====第5封邮件====

发件人：Li Qi
发送时间：2021-03-22 11:10:46.389000+00:00
邮件内容:
张先生，您好：
收到您的邮件，打开后无法显示如您截图的页面：
根据您的截图，OCR基于内网页面控件的渲染结果与外网的测试结果不同。
1.	外网为汉字内容表现不同，OCR为非汉字内容表现不同。
2.	在IE11中，外网为汉字显示杂色，OCR为非汉字显示杂色。
您的需求目前我已了解，接下来我们首先针对第一点即IE8和IE11的不同渲染结果进行排查（无论是汉字内容或非汉字内容的不同表现结果），请您知悉，谢谢。

====第6封邮件====

发件人：Li Qi
发送时间：2021-03-23 16:50:06.518000+00:00
邮件内容:
张先生，您好：
为进一步排查该问题，请在CMGE系统上按照如下步骤收取fiddler日志和步骤记录器内容
1.	从https://www.telerik.com/download/fiddler <https://www.telerik.com/download/fiddler> 下载并安装Fiddler。
2.	关闭所有IE浏览器进程，确保在任务管理器的进程列表中看不到iexplore.exe
3.	打开步骤记录器（点击开始-windows附件-步骤记录器）并开始录制。
4.	打开Fiddler，点击Clear Cache按钮清除IE缓存。
5.	然后运行iexplore.exe about:blank打开一个空白的IE窗口。
6.	在这个空白IE窗口中以最短的步骤打开到那个事件列表的页面。
7.	回到Fiddler，保存日志成saz文件。
8.	保存步骤记录器日志。
将7,8两步的收集日志按如下方法上传
您可以登陆https://cduc.cmgos.com <https://cduc.cmgos.com/> ，通过数据上传系统上传您所收集的日志信息。如果登录不成功，点击后退即可
用户名：zhangjie
密码：zhangjie
注意，

====第7封邮件====

发件人：Li Qi
发送时间：2021-03-24 10:08:35.635000+00:00
邮件内容:
张先生，您好：
感谢您的回复。我十分理解您的疑问，结合我们这段时间的沟通与测试，我整理了如下表格方便您的理解。
系统环境
www.baidu.com <http://www.baidu.com/> 
OCR内网页面（客户提供的截图）
OCR的静态html页面
汉字
非汉字
汉字
非汉字
汉字
非汉字
Win7+IE8
纯色
杂色
纯色
纯色
纯色
杂色
Win7+IE11
杂色
杂色
纯色
杂色
纯色
杂色
Win10+IE11
杂色
杂色
纯色
杂色
杂色
杂色
从上表中，我们可以看到不同的操作系统和不同IE浏览器版本针对不同的站点有不同的表现形式，并且也没有找到对应的规律。对于字体渲染方式在IE浏览器的升级演变过程中，随着W3C标准的变化，我们已经确认是有变化的。但这种变化我没有在内外部的文档资料上找到会引发当前问题的关联性。通过您提供的截图信息，也确实证明与外网站点的默认渲染结果是不同的。正如之前电话中所述，IE的文字渲染其实是调用了系统底层的绘图API进行的，举例来说，IE告诉操作系统需要在屏幕的(x,y)坐标处画一个颜色为#000000的大小为12px字体为宋体的阿拉伯数字2，而IE本身并不会自己去计算这个数字2的每个像素点应该怎么陈列。这就导致渲染结果有随机性。这中间牵涉的变量包括：
1.	不同操作系统和不同IE浏览器的区别（包括安装方式，版本差异，定制的组策略和服务内容）
2.	企业内网的网络环境
3.	安装的第三方软件的影响
4.	访问站点的源代码表现
我十分理解对于您来说，您希望的效果是纯色显示OCR页面的字体内容，而从我们已进行的测试结果来看，纯色显示其实并不是Win10和IE11的默认渲染结果，应是OCR页面加载后的编译结果。因此日志收集的建议是为了主要针对OCR页面加载后的渲染过程。即在内网环境下，使用CMGE系统抓取OCR页面的加载。通过fiddler的收取和本地编译，分析在加载页面的过程中该页面是如何渲染字体的。请您知悉。谢谢。
PS：fiddler日志的分析可以对当前问题进行本地复现，因此请按照之前的步骤一步步按顺序进行，不要跳过任何一步（如clear cache的步骤）。

====第8封邮件====

发件人：Li Qi
发送时间：2021-03-30 14:01:40.827000+00:00
邮件内容:
张先生，您好：
如上午电话沟通，经您的确认，该case将暂做关闭处理，以下为案例总结，请您知悉：
Case No：CAS-03900-Z6K3J1
问题描述：
=====================
用户反馈OCR在IE下存在不能识别的问题，经查因发现，系CMGE下，英文字符点阵颜色不纯造成，原win7正常纯色
问题分析：
=====================
系统环境
www.baidu.com <http://www.baidu.com/> 
OCR页面
OCR的静态html页面
汉字
非汉字
汉字
非汉字
汉字
非汉字
Win7+IE8
纯色
杂色
纯色
纯色
纯色
杂色
Win7+IE11
杂色
杂色
纯色
杂色
纯色
杂色
Win10+IE11
杂色
杂色
纯色
杂色
杂色
杂色
经测试，在IE8中可以看到数字和字母都是柔化显示的，只有中文的渲染没有柔化显示。这一点在之后的某个IE版本中进行了改进，导致IE11呈现为现在这样的柔化结果。接下来又分别测试了Chrome浏览器和Word，中文显示均有杂色，可以说柔化的文字渲染已经在业界达成了一种共识，IE8是为数不多的锐化显示的案例。基于这样的一种优化，这不应该被认为是一个浏览器方面的问题，而是OCR识别应该更加智能化，如果只能通过某一种固定的颜色来识别具体是什么文字，其使用范围过于狭窄，因此建议客户通过升级OCR或寻求OCR技术支持看看是否有解决方案。
文字渲染引擎的工作机制是很复杂的，它有一套复杂的算法机制来决定文字的渲染结果，比如背景色是什么颜色？背景是纯色还是渐变色还是图片？文字本身是什么颜色？文字用的什么字体？有没有粗体？文字附近有没有其他文字或其它几何图形？文字本身是否覆盖于其它图层之上或者有没有其他图层覆盖在文字之上等等。文字渲染引擎通过这些因素最终决定渲染的时候哪里需要加入杂色来柔化显示效果，哪里是不需要的。举例来说黑色文字显示在白色背景之上，由于颜色反差度大，则需要柔化。相反如果在一个粉红色的背景上显示红色的文字，因为两种颜色比较接近，这时候为了让用户更容易看清楚文字，可能就不需要过度柔化文字显示，反而需要锐化文字显示，使文字的几何边界与背景更容易区分开来。因此，在IE11和CMGE都确定的情况下，不同的站点页面也会基于代码编写，CSS样式，图层间的色差甚至网络等诸多因素而呈现不同的字体渲染结果。从这个角度理解，如果该问题有解决方法，这个方法也是更倾向于针对特定页面的解决，并不能通过固定的IE或Windows设置或代码改造来解决所有页面的字体渲染问题。
应该说有杂色和没有杂色都是一种正常的渲染结果，从这一层面来说，OCR的文字识别应当进行相应的适配。通过文字边界、形状来正确识别文字，而不应该局限在固定某一种颜色上。
问题总结：
=====================
用户表示理解，经用户的确认，该case做关闭处理。 
以上，如您后续有任何问题，可随时与我们联系，谢谢。
