邮件主题：回复: [案例号: CAS-11763-G9J8L0 ] % |P2|ICBC|工行用户反馈v2020-L 无法执行VBS脚本提示权限不足问题-周鹏 % 初次响应 CMIT:0001583

====第1封邮件====

发件人：Wei Liang
发送时间：2024-07-16 16:24:22.860000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
根据您提供的信息，我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
工行用户反馈周鹏设备无法执行VBS脚本，提示权限不足，需要协助排查。
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
请您先在问题设备上使用Procmon工具抓取执行VBS脚本失败的日志，并使用CMGE日志收集工具收集问题设备的基本日志用于排查问题，将这些日志压缩后通过CDUC上传，谢谢。

====第2封邮件====

发件人：Wei Liang
发送时间：2024-07-17 11:17:22.072000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
查看您上传的问题设备的VBS报错的procmon日志，其中并未记录VBS脚本运行过程的日志，需要重新收集对应的日志。
刚刚与最终用户电话说明了这一情况，请用户再次收集procmon日志，并提供给我们进一步分析。
Procmon日志
1）双击procmon.exe运行，点击Accept后，到达此页面，会有有大量条目出现，注意图标状态，显示如图所示图标，表示当前正在当前处于抓取状态；
2）此时运行VBS脚本，复现权限不足问题，将报错信息关闭。
3）此时回到Process Monitor窗口，单击Capture图标，停止抓取；
4）点击File, 点击Save. 选择"All events" and "Native Process Monitor Format (PML)"点击OK。记录文件保存位置，并将PML文件打包压缩通过CDUC上传。

====第3封邮件====

发件人：Wei Liang
发送时间：2024-07-18 16:29:17.755000+00:00
邮件内容:
许先生 您好：
来信是想咨询当前案例进展情况。
与最终用户电话沟通确认是近期运行新终端应用Win_NCTB..exe会提示权限问题，但是选择“以管理员权限”运行就不会有错误提示，其他用户的设备运行新终端应用不会出现此问题。
已建议用户提供新终端应用中的SendDocs.vbs脚本，并分别抓取正常设备启动Win_NCTB.exe的procmon日志、以及使用“管理员权限运行”Win_NCTB.exe的procmon日志。
最终用户收集了这些日志后，请您将这些日志通过CDUC上传，提供给我们进一步排查，谢谢。

====第4封邮件====

发件人：Wei Liang
发送时间：2024-07-22 15:26:25.673000+00:00
邮件内容:
许先生 您好：
查看您提供的报错截图，提示SendDocs.vbs脚本第14行执行报错，提示没有权限。
查看SendDocs.vbs脚本对应的报错行的具体代码是f.Attributes = 1，其具体含义是将对应的文件设置为只读属性，这涉及对相关文件的操作，可能需要相关的权限。
查看脚本的具体情况，其需要操作C:\Program Files\ICBC\NCTB\hrfhexcel\jzclyw.xls文件，需要查看此文件的安全属性情况，如下图所示：
而针对修改处于系统目录（Program Files）下的文件时，可能需要管理员权限。
查看收集的问题设备的procmon日志，其并没有关闭UAC（完全关闭UAC时enableLUA键值为0）
所以双击运行vbs脚本修改C:\Program Files\ICBC\NCTB\hrfhexcel\jzclyw.xls文件为只读时，会提示权限不足，但是选择“以管理员权限”运行时，则可以正常运行。
排查建议：
1）查看其他正常运行的设备是否完全关闭了UAC。（运行gpedit.msc查看组策略：用户帐户控制：以管理员批准模式运行所有管理员 设置为已禁用）
如果确认了正常的设备的UAC就是完全关闭的状态，则也可以将问题设备的UAC完全关闭，确认是否解决问题。
2）对比查看其他正常设备上的C:\Program Files\ICBC\NCTB\hrfhexcel\jzclyw.xls文件的安全属性情况，是否有区别。
3）在新终端应用Win_NCTB.exe的兼容性设置中，勾选“以管理员身份运行此程序”，作为规避方案。

====第5封邮件====

发件人：Wei Liang
发送时间：2024-07-24 10:56:07.237000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
如电话中所说，最终用户计划重新安装操作系统，然后再与用户联系确认问题是否解决。
如果有任何进展或疑问可以回复此邮件，谢谢。

====第6封邮件====

发件人：Wei Liang
发送时间：2024-07-26 15:25:14.140000+00:00
邮件内容:
许先生 您好：
感谢您的电话接听。
确认您的问题已经解决，我将归档此案例。
工单的归档并不会影响我们为您提供技术支持服务，如有其他问题，您可以随时联系我们。
案例总结：
----
问题定义：
工行用户反馈周鹏设备无法执行VBS脚本，提示权限不足，需要协助排查。
问题总结：
查看问题vbs脚本具体的报错行的代码信息，在运行脚本过程中报错提示权限不足，涉及的文件在系统目录（program files）中，其具体操作需要管理员权限，出现这个问题与问题设备的UAC配置有关。
最终用户未重新配置UAC，计划重新安装操作系统，案例关闭。
问题排查：
运行SendDocs.vbs脚本报错，第14行执行报错，提示没有权限。
查看SendDocs.vbs脚本对应的报错行的具体代码是f.Attributes = 1，其具体含义是将对应的文件设置为只读属性，这涉及对相关文件的操作，可能需要相关的权限。
查看脚本的具体情况，其需要操作C:\Program Files\ICBC\NCTB\hrfhexcel\jzclyw.xls文件。
而针对修改处于系统目录（Program Files）下的文件时，可能需要管理员权限。
查看收集的问题设备的procmon日志，其并没有关闭UAC（完全关闭UAC时enableLUA键值为0）
所以双击运行vbs脚本修改C:\Program Files\ICBC\NCTB\hrfhexcel\jzclyw.xls文件为只读时，会提示权限不足，但是选择“以管理员权限”运行时，则可以正常运行。
问题处理：
1）查看其他正常运行的设备是否完全关闭了UAC。（运行gpedit.msc查看组策略：用户帐户控制：以管理员批准模式运行所有管理员 设置为已禁用）
如果确认了正常的设备的UAC就是完全关闭的状态，则也可以将问题设备的UAC完全关闭，确认是否解决问题。
以上，如您后续有任何问题，可随时与我们联系，谢谢。
