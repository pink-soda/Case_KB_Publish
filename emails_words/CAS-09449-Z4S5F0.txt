邮件主题：回复: [案例号: CAS-09449-Z4S5F0 ] % TAM-陕西省市场监督管理局客户反馈打印机服务开机自动禁用问题 % 初次响应 CMIT:0001306

====第1封邮件====

发件人：Wei Liang
发送时间：2023-07-24 17:22:42.835000+00:00
邮件内容:
严先生 您好：
感谢您的电话接听。
根据您提供的信息，我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
陕西省市场监督管理局客户反馈Print Spooler服务在开机时自动停止，此时手动点击可以运行，需要协助分析问题原因。
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
从系统日志中可以看到Spooler服务由于连接超时启动失败：
测试建议：
1）您可以尝试修改Print Spooler服务为“自动（延迟启动）”，观察是否可以改善Spooler服务启动失败的问题。
2）检查出现Spooler服务未启动的问题时，打印机后台处理程序文件夹中是否还有打印队列。具体操作如图所示：
打开C:\Windows\System32\spool\PRINTERS文件夹，检查是否存在文件，如有就删除所有文件。
3）可以采用计划任务方式配置出现Spooler服务未启动时，自动尝试启动Spooler服务，具体的计划任务配置我会在本地验证后再通过脚本方式提供给您测试。
日志收取:
如果方便收取以下的日志，可以协助我们进一步排查问题。
1）运行regedit打开注册表编辑器，定位到：HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\Spooler
在左侧的spooler列表上点击右键，选择“导出”，导出对应的spooler服务的注册表配置信息。
2）下载附件中的procmon.zip文件，解压后运行procmon.exe，选中options->Enable Boot Logging：
3）配置Boot Logging选项：
4）重启设备，登录系统后，如果复现了Print Spooler服务未启动的问题，及时运行procmon.exe，会弹出窗口提示boot log日志已经收集，请点击Yes保存，并将文件存储到为boot_log.pml，将此日志压缩后上传。
注意：如果没有复现问题，登录系统后也需要运行procmon.exe，但是在弹窗提示时点击No不保存日志，然后再重新配置boot logging，直到复现Print Spooler服务未启动的问题时再保存procmon日志。
日志上传方法：
您可以登陆https://cduc.cmgos.com，通过数据上传系统上传您所收集的日志信息。
用户名：guanliju
密码：guanliju
注意：添加文件，点击上传后，跳转到新的页面点击保存。

====第2封邮件====

发件人：Wei Liang
发送时间：2023-07-26 14:56:22.012000+00:00
邮件内容:
严先生 您好：
鉴于您的这个问题不定时出现，无法准确收取到出现问题时的procmon日志，但是手动可以启动spooler服务。
在系统日志中可以看到spooler服务启动失败的提示。
为缓解此问题，建议进行以下配置测试：
1）尝试修改Print Spooler服务为“自动（延迟启动）”，观察是否可以改善Spooler服务启动失败的问题。
2）检查出现Spooler服务未启动的问题时，打印机后台处理程序文件夹中是否还有打印队列。具体操作如图所示：
打开C:\Windows\System32\spool\PRINTERS文件夹，检查是否存在文件，如有就删除所有文件。
3）可以采用计划任务方式配置出现Spooler服务未启动时，自动尝试启动Spooler服务。
具体的计划任务配置操作可以通过执行附件中的脚本完成。
1、将附件中的spooler.txt文件下载后修改后缀为spooler.bat脚本。
2、双击提示以管理员权限运行spooler.bat脚本，会创建一个cmit\spooler计划任务，当系统事件日志中出现7000或7009事件时，会在1分钟后自动启动spooler服务。

====第3封邮件====

发件人：Wei Liang
发送时间：2023-07-26 14:57:29.322000+00:00
邮件内容:
严先生 您好：
加上spooler.txt附件 。

====第4封邮件====

发件人：Wei Liang
发送时间：2023-07-31 15:22:13.732000+00:00
邮件内容:
严先生 您好：
感谢您的电话接听。
经过您的同意，我将暂时归档此案例。
工单的归档并不会影响我们为您提供技术支持服务，如有其他问题，您可以随时联系我们。
案例总结：
----
问题定义：
陕西省市场监督管理局客户反馈Print Spooler服务在开机时自动停止，此时手动点击可以运行，需要协助分析问题原因。
问题总结：
这个问题不定时出现，无法收集到出问题时的procmon日志。基于类似案例和用户实际问题场景，暂时采用以下缓解方法：通过脚本方式创建计划任务监控spooler服务启动超时后，再次启动服务。如果后续可以固定复现问题，再收集相关日志进一步处理。
脚本使用方法：
1、将附件中的spooler.txt文件下载后修改后缀为spooler.bat脚本。
2、双击提示以管理员权限运行spooler.bat脚本，会创建一个cmit\spooler计划任务，当系统事件日志中出现7000或7009事件时，会在1分钟后自动启动spooler服务。
以上，如您后续有任何问题，可随时与我们联系，谢谢。
