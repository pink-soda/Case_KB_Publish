邮件主题：回复: [案例号: CAS-12468-R4Q1X3 ] % 售前-兴业银行用户反馈V2020-L升级提示安装失败问题 % 初次响应 CMIT:0001043

====第1封邮件====

发件人：Jia Wei
发送时间：2024-11-12 17:14:57.049000+00:00
邮件内容:
胡先生，您好
很高兴与您电话沟通，您可以按照日志收集部分收集日志并反馈。
问题定义: 
反馈V2020-L升级至V2022-L时到86%左右会重启后就报错：Windows 10 安装失败
问题范围: 
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
日志收集：
一、工具收集
1）在出现问题的计算机上，下载附件《CMGELogCollector.zip》文件并解压到本地磁盘。双击运行exe文件，同意后，按照下图勾选系统日志，组策略信息、网络信息、软件信息，系统进程、更新日志，升级日志点击收集。 
工具下载链接 CMGELogCollector : https://cduc.cmgos.com/download.php?id=1479&token=m1qgs2Xwo3hXokAIJvWUpJHeffUlC0Gg
2）收集完毕后将在当前用户桌面生产CMGE_Log。点击确定，将直接打开文件夹并定为压缩文件。 
3）将压缩文件上传。
用户名：xyyhhxs
密码：xyyhhxs
--------------

====第2封邮件====

发件人：Jia Wei
发送时间：2024-11-13 11:00:47.789000+00:00
邮件内容:
胡先生，您好
很高效与您电话沟通，根据沟通的结果，您可以参考本邮件操作。
日志分析：
根据日志中的信息，目前看到的是在升级过程中“update Boot Sector”阶段，写入启动扇区时失败。（报错为0x80070005，意为Access Denied，被拒绝访问）
建议操作：
1）同时按下Windows+R, 输入cmd，同时按下ctrl shift enter以管理员身份运行命令提示符：
2）运行bcdedit并截图，如果如下图所示：device为partition=C: 而没有path属性，则为MBR+BIOS启动模式。您可以将此截图/照片反馈。
如果出现问题的计算机为MBR 格式， 您可以按照如下内容操作，查看并反馈：
1.	List Partition截图，对比正常和升级失败机器，确认磁盘分区是否一致
2.	为启动分区分配盘符Z，查看Z:\Boot文件夹的高级安全选项（如果要看到Boot文件夹，需要按照图中反选“隐藏受保护的操作系统文件”）
3.	确认“SYSTEM”和“Administrators”是否有“Full Control”权限
--------------

====第3封邮件====

发件人：Jia Wei
发送时间：2024-11-15 09:25:06.156000+00:00
邮件内容:
胡先生，您好
感谢您的耐心等待。
日志分析：
根据提供的日志和截图信息，对比正常和异常升级信息，目前发现故障机器缺少恢复分区，而之前也有因此原因导致升级失败的案例。
故障机器：
正常机器：
正常情况下基于BIOS的硬盘应该的分区布局应该如下图所示：
您可以参考如下内容操作，尝试修复。
建议操作：
手动创建恢复分区（已确认故障机器是MBR格式）：
1）插入CMGE安装光盘或U盘，从系统安装盘启动。启动后同时按下Shift+F10，调出CMD窗口
2）在cmd中输入diskpart：
DISKPART> list disk
DISKPART> sel disk 1
DISKPART> list part
DISKPART> sel part 1(选择实际的操作系统分区)
3）收缩卷：
DISKPART> shrink desired=500 minimum=500
4）创建恢复分区：
DISKPART> create partition primary id=27
DISKPART> format quick fs=ntfs label="Windows RE tools"
DISKPART>  set id=27
5）退出diskpart
DISKPART> exit
6）重新启动WinRE：
reagentc /enable
7）再次升级机器。
--------------

====第4封邮件====

发件人：Jia Wei
发送时间：2024-11-20 10:33:36.145000+00:00
邮件内容:
胡先生，您好
根据当前的日志，如果继续查看在升级过程Finalize阶段执行update boot sector阶段失败的具体原因，需要按照如下步骤收集并反馈日志。
日志收集：
一、Procmon日志。
1）下载ProcessMonitor工具：https://cduc.cmgos.com/download.php?id=1148&token=SOpiUWzWQV2jjRu0jOeKp8ZP7QJTMJBw
2）在问题计算机上，下载解压附件ProcessMonitor.zip。双击Procmon.exe运行，到达此页面，会有有大量条目出现，当前已经开始抓取；
i. 先反选按钮1，停止抓取；
ii. 再点击按钮2，清除现有日志；
3）安装升级：双击setup.exe进入升级流程，等待大约50%左右（问题复现之前）进入应用点击如下Capture按钮开始抓取日志，等待安装直至问题复现。返回Process Monitor窗口（可以按Alt+Tab切换窗口），再单击反选Capture，停止抓取
4）点击File, 点击Save. 选择"All events" and "Native Process Monitor Format (PML)"点击OK。 
压缩并将问题日志、以及问题时间点反馈。
二、收集setupreport日志：
	1.	下载附件中的Windows日志收集脚本，下载后将setupreport.txt重命名为setupreport.cmd
	2.	以管理员身份运行setupreport.cmd脚本（（该脚本将运行10-20分钟，运行完后会有相关提示请耐心等待。如果出现报错请不用担心，是正常现象）。
	3.	在C盘下会创建一个Setup_Report_xxx文件夹，打包并上传这个文件夹。
--------------

====第5封邮件====

发件人：Jia Wei
发送时间：2024-11-22 10:52:02.378000+00:00
邮件内容:
胡先生，您好
很高兴与您电话沟通，您可以参考附件，尝试在Clean Boot环境升级并收集日志，以减小日志大小。
--------------

====第6封邮件====

发件人：Jia Wei
发送时间：2024-11-25 10:05:06.290000+00:00
邮件内容:
胡先生，您好
看到您的回复，Msconfig两项服务的供应商为Intel，应该是厂商硬件对应的服务。应该不会有影响
此外，之前日志中看到：SetupHost.exe执行命令过程对于C:盘有Create File的操作，但结果是Access Denied，可以看到当时介入的Module有“奇安信”、LVUAAgentInstBaseRoot、Dsm应用
如果需要排查问题原因，可以遇到类似问题时逐一卸载上述app，确认是否可以升级成功。
--------------

====第7封邮件====

发件人：Jia Wei
发送时间：2024-11-27 17:49:04.848000+00:00
邮件内容:
胡先生，您好
沧州升级失败的问题收到了客户的报错照片，您可以让用户按照如下内容收集日志。只有问题截图无法准确定位问题原因。
日志收集：
一、工具收集
1）在出现问题的计算机上，下载附件《CMGELogCollector.zip》文件并解压到本地磁盘。双击运行exe文件，同意后，按照下图勾选系统日志，组策略信息、网络信息、软件信息，系统进程、更新日志，升级日志点击收集。 
工具下载链接 CMGELogCollector : https://cduc.cmgos.com/download.php?id=1479&token=m1qgs2Xwo3hXokAIJvWUpJHeffUlC0Gg
2）收集完毕后将在当前用户桌面生产CMGE_Log。点击确定，将直接打开文件夹并定为压缩文件。 
3）将压缩文件上传。
用户名：xyyhhxs
密码：xyyhhxs
--------------

====第8封邮件====

发件人：Jia Wei
发送时间：2024-12-05 16:10:17.503000+00:00
邮件内容:
胡先生，您好
很高兴与您沟通，根据沟通的结果，我将暂时归档此问题。案例归档后您会收到调查问卷的邮件，希望可以对我们的服务进行评价。
案例总结：
案例描述：
CMGE V2020-L升级至V2022-L到86%左右会重启后就报错。
案例进展：
建议用户开启Clean Boot后升级成功。Procmon可以看到当时介入的Module有“奇安信”、LVUAAgentInstBaseRoot、Dsm应用
由于无法看到具体是哪个应用组织升级，且目前升级正常， 和用户沟通可以归档案例。
--------------
