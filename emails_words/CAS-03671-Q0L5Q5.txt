邮件主题：回复: 案例号: CAS-03671-Q0L5Q5 ] % |P2|ICBC|插件安装后其他域账号无法使用 % 初次响应 CMIT:0001096

====第1封邮件====

发件人：Jia Wei
发送时间：2021-01-15 11:04:05.178000+00:00
邮件内容:
阮女士，您好
很高兴与您电话沟通，根据刚刚沟通的结果，您可以通过如下方式上传您有问题的web demo和插件，并回复此邮件具体安装方法和判断是否调用成功的方法。
我将在本地进行troubleshooting，并尽快再次与您取得联系。
文件上传：
您可以登陆https://cduc.cmgos.com <https://cduc.cmgos.com/> ，通过数据上传系统上传您所收集的日志信息。如果登录不成功，点击后退即可
用户名：ICBC001
注意，
--------------
服务电话： 400-818-0055

====第2封邮件====

发件人：Jia Wei
发送时间：2021-01-15 17:23:06.255000+00:00
邮件内容:
阮女士 您好, 
根据之前的讨论, 我谨在此阐述我们双方针对这个问题所涉及范围界定：
问题定义:
管理员为所有人安装插件后，其他域用户拥有文件夹权限、程序中可以看到插件信息的情况下，仍无法调起插件，无法将插件添加到注册表中。打开测试网页报错：ocx控件未安装。
1）插件是exe文件，基于IE的OCX插件，访问IE网站，通过调插件的方法，与服务器交互。
2）初始化不成功会报错。
3）本地用户外网可以用，内网域用户无法使用 。
问题范围:
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。
问题分析：
我尝试在本地环境进行问题复现，但没有复现您的问题现象。
场景：在加域环境下进行了多次测试：使用本地用户安装控件，再分别使用普通域用户、域管理员用户和本地用户进行测试。
结论：连接外网可以正常登录。没有出现问题现象：ocx控件未安装。
图为使用Domain User登录，打开index.html的结果：登陆成功。
此外，测试中发现：正常安装ocx控件之后，即使在完全断网的情况下，也不会出现ocx控件未安装的报错。
基于上述测试结果，纯净版CMGE V2020-L目前可以正常调用插件。我们可以把问题排查重心放软件环境、策略限制以及在ocx控件本身，暂时判断与网络问题关系可能性较小。
建议操作：
一、权限确认：
1）确认当前C:\Program Files\ZegoLiveRoomActiveX文件夹，及其父文件夹对于Users是否有如下权限。
2）当前用户隶属于Domain Users组。
二、重新注册dll ocx文件
1）以有问题的用户账户登录，以管理员身份运行命令提示符cmd。
2）分别运行如下命令，查看是否会有报错：
for %1 in (“C:\Program Files\ZegoLiveRoomActiveX\*.dll”) do regsvr32.exe /s %1
for %1 in (“C:\Program Files\ZegoLiveRoomActiveX\*.ocx”) do regsvr32.exe /s %1
三、如果上述操作没有解决此问题，且鉴于目前ICBC环境的特殊性，您可以参考如下排错思路，进行对比测试troubleshooting
1）安装纯净CMGE V2020-L ICBC定制系统，不加域在外网环境测试。
2）如果报错ocx未安装，建议从镜像定制项进行排查；
如果正常登录，则加域（除了必须的apps，不安装其他三方软件）测试
3）如果报错ocx未安装，建议检查管控软件、刚刚安装的其他三方软件以及推送的组策略限制（是否有开机启动的脚本文件或计划任务限制）；
如果可以正常登录，建议逐一安装其他三方apps进行排查。
目前此问题复现情况比较特殊，为了进一步定位问题原因，还需要您收集如下日志：
日志收集：
一、使用ProceExplorer工具查看控件调用情况
1）分别在运行正常和有问题的PC上，以管理员身份运行procexp64.exe
2）同时按下ctrl+D下方会显示dll列表，再定位到iexplorer.exe
3）以Company Name排列，以便找到加载的Zego插件信息。（由于可能有多个iexplorer.exe进程，建议谨慎查看）
4）确认登陆成功和登陆失败报错的PC，对于Zego插件调用情况是否一致？并反馈截图信息。
二、使用工具进行日志收集
1）首先，在计算机上下载附件CMGELogCollector.zip文件并解压到本地磁盘，在登陆成功和登录失败的场景下分别进行如下操作收集日志：再双击运行exe文件，同意后，按照下图勾选系统日志，组策略信息、网络信息、软件信息，系统进程、已安装补丁，点击收集。 
2）收集完毕后将在当前用户桌面生产CMGE_Log。点击确定，将直接打开文件夹并定位压缩文件。 
3）将压缩文件上传。
三、收集ProcMon日志
在登录成功的和登陆失败的PC上，分别进行如下操作： 
1）请下载并解压附件ProcessMonitor.zip； 
2）双击Procmon.exe运行，到达此页面，会有有大量条目出现，先后点击1，2暂停抓取并清除当前条目。当前已经是可抓取状态； 
3）准备好复现条件，点击下图的图标开始抓取。复现问题（针对本案例是“点击刷新页面“，直至问题报错出现），记录时间点（对于案例分析极为重要。例如出现弹框报错的时间点），出现问题现象后。回到Process Monitor窗口，单击Capture，停止抓取； 
4）点击File, 点击Save. 选择"All events" and "Native Process Monitor Format (PML)"点击OK。记录文件保存位置； 
5）将上述2个PML文件打包压缩上传。
文件上传：
您可以登陆https://cduc.cmgos.com <https://cduc.cmgos.com/> ，通过数据上传系统上传您所收集的日志信息。如果登录不成功，点击后退即可
用户名：ICBC001
注意，
--------------
服务电话： 400-818-0055

====第3封邮件====

发件人：win10升级支持
发送时间：2021-01-19 15:03:11.414000+00:00
邮件内容:
贾工，你好 
        该问题已经解决，案例可以归档。 
解决方案： 
重新注册控件，打开cmd。运行regsvr32 xxxx.dll 

====第4封邮件====

发件人：Jia Wei
发送时间：2021-01-19 15:24:04.587000+00:00
邮件内容:
吴先生, 阮女士 您好!
很高兴收到您的反馈邮件，根据沟通的结果，我将暂时归档此问题。案例归档后您会收到调查问卷的邮件，希望可以对我们的服务进行评价。 
工单的归档并不会影响我们为您提供技术支持服务，如果您的问题复现，或有新的问题出现，您也可以致电我们的技术支持热线4008180055。
案例总结：
案例描述：
管理员为所有人安装插件后，其他域用户拥有文件夹权限、程序中可以看到插件信息的情况下，仍无法调起插件，无法将插件添加到注册表中。打开测试网页报错：ocx控件未安装。 
1）插件是exe文件，基于IE的OCX插件，访问IE网站，通过调插件的方法，与服务器交互。 
2）初始化不成功会报错。 
3）本地用户外网可以用，内网域用户无法使用 。 
建议操作：
重新注册dll ocx文件 
1）以有问题的用户账户登录，以管理员身份运行命令提示符cmd。 
2）分别运行如下命令，查看是否会有报错：
for %1 in (“C:\Program Files\ZegoLiveRoomActiveX\*.dll”) do regsvr32.exe /s %1 
for %1 in (“C:\Program Files\ZegoLiveRoomActiveX\*.ocx”) do regsvr32.exe /s %1 
案例进展：
最终用户确认通过重新注册dll文件的方式解决问题。
--------------
服务电话： 400-818-0055

====第5封邮件====

发件人：/o=cmit/ou=Exchange Administrative Group (FYDIBOHF23SPDLT)/cn=Recipients/cn=user7a071bfa
发送时间：2021-02-03 10:17:07.493000+00:00
邮件内容:
Hi 贾伟，
刚接到毓杰电话，希望re-open这个case，case依然按照P2级别处理。
从电话中了解到的信息如下：使用管理员用户注册OCX控件后，切换到普通用户（无管理员权限）后桌面无法显示，目前系统处于测试阶段，暂只发现这一台电脑。具体信息可继续联系阮女士。
谢谢。
Best Regards!
王文磊
________________________________
www.cmgos.com <http://www.cmgos.com/> 
Email: wangwl@cmgos.com <mailto:wangwl@cmgos.com> 
Mobile: + 86 186 1036 8080

====第6封邮件====

发件人：Jia Wei
发送时间：2021-02-03 10:37:15.917000+00:00
邮件内容:
Hi Wenlei,
已经与阮女士电话沟通，此问题与之前处理的“ocx控件未安装”问题不一致，为全新的问题现象。我们需要单独创建案例处理。
--------------
