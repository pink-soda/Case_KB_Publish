邮件主题：回复: [案例号: CAS-06002-G1Y4W4 ] % |P2|ICBC|工行开发中心蓝屏问题 % 初次响应 CMIT:0001110

====第1封邮件====

发件人：Li Qi
发送时间：2022-04-06 17:10:08.860000+00:00
邮件内容:
Hi，毓杰：
如刚才电话沟通，发送此邮件向您阐述我们双方针对这个问题所涉及范围界定： 
问题定义: 
用户反馈1台电脑经常性蓝屏，使用不同的无线认证方式，PMK缓存已禁用，分析蓝屏dump，优先排查是否与TMS有关
问题范围: 
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。 
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。 
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。 

====第2封邮件====

发件人：Li Qi
发送时间：2022-04-06 17:12:26.064000+00:00
邮件内容:

====第3封邮件====

发件人：Li Qi
发送时间：2022-04-07 16:35:22.053000+00:00
邮件内容:
Hi，毓杰：
       如下午电话沟通，经dump分析，此次蓝屏的原因是nwifi!Dot11SendCompletion处理NBL时出现异常，对应的 NBL 为 ffffb4057dec6d80 。
       目前有关NBL的蓝屏问题在于本地网卡传递给filter driver（vwifimf）时申请NdisPoolHandle(filterhandle)，vwifimf在处理时创建新的NBL会将此filterhandle赋值给新的NBL（netbufferlist->sourcehandle=filterhandle）。作为新的NBL的sourcehandle，以用作后续执行sendnetbufferlistcomplete时的判断条件（判断是否为原始NBL，若netbufferlist->sourcehandle==pfilter->filterhandle相同，则重组释放此NBL），在真正执行sendnetbufferlistcomplete的判断时，由于不相等，所以调用ndis! Sendnetbufferlistcomplete导致蓝屏。
       因此通过调试log，需要确认vwifimf创建新的NBL时的filterhandle的值，以及执行sendnetbufferlistcomplete的pfilter->filterhandle的值。
       关于当前case，同样遵循上述分析思路，需要在安装调试版本的TMS电脑上，复现问题，由双方建立在同一次蓝屏的基础上各自抓取相应的关键值进行比较。方可进一步定位。
       考虑到当前用户不便进一步配合收取更多的dump日志，可选择测试机进行。如当前用户还有其他问题，可随时联系我，谢谢。

====第4封邮件====

发件人：Li Qi
发送时间：2022-04-12 15:58:34.320000+00:00
邮件内容:
Hi，毓杰：
       如刚才电话沟通，由于近期用户电脑未发生蓝屏问题，经您的同意，此case将暂做归档处理，以下为案例总结，请您知悉：
Case No：CAS-06002-G1Y4W4
问题描述：
=====================
用户反馈1台电脑经常性蓝屏，使用不同的无线认证方式，PMK缓存已禁用，分析蓝屏dump，优先排查是否与TMS有关
问题分析：
=====================
该蓝屏dump是由于nwifi!Dot11SendCompletion处理NBL时出现异常导致，与之前所述TMS在处理网络数据包时引发的问题相同，用户表示知悉。
问题总结：
=====================
经用户确认，近期未在发生蓝屏问题，暂时归档此案例。
以上，如您后续有任何问题，可随时与我们联系，谢谢。
