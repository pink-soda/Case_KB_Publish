邮件主题：回复: [案例号: CAS-09236-W3G9N7 ] % |P2|ICBC|工行反馈xps普通用户无法正常访问 % 初次响应 CMIT:0001821

====第1封邮件====

发件人：Li Qi
发送时间：2023-06-27 14:38:47.280000+00:00
邮件内容:
许先生，您好：
       如刚才电话沟通，谨以此封邮件阐述我们双方针对这个问题所涉及范围界定： 
问题定义: 
用户反馈xps文件普通用户无法正常访问，提示位图错误的报错信息。
问题范围: 
我们将协助您分析处理上述问题，并对定义的问题给予最大的技术支持。 
如果能及时解决问题，或问题属于产品设计的行为，或问题涉及到三方，我们将考虑关闭案例。如果存在多个问题，则我们考虑拆分案例进行分析。 
接下来，我们将开始合作解决这个问题。如果您对以上的问题范围界定有任何异议，请尽快告知。如果您有其他任何疑问。也欢迎随时与我联系。 
下一步动作：
经对比procmon日志分析，发现错误日志中xps文件的默认关联方式为mspaint画图板打开，而画图板无法正确识别xps文件进而导致报错：不是有效的位图文件。具体内容参见下图：
正常打开：
错误打开：
鉴于用户已在失败电脑上安装xps viewer应用，可以打开此应用，再拖入xps文件看是否可以正常打开。
如果使用双击方式，则需要设置默认关联程序，可以在以下注册表路径查看：
HKEY_CURRENT_USER\SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xps\UserChoice，其中ProgId的值应为：Windows.XPSReachViewer

====第2封邮件====

发件人：Li Qi
发送时间：2023-06-29 11:18:12.915000+00:00
邮件内容:
许工，您好：
       我又看了下失败与成功的对比日志，参见下方内容：
成功日志：
可以看到，在用户双击xps文件后，操作系统经由文件资源管理器找到xps viewer执行，而失败日志则调用了mspaint.exe来执行。
失败日志：
为什么会有这种区别，操作系统是如何找到mspaint的呢？
我在两份procmon中都看到了操作系统查找xps viewer的打开命令
但是失败的日志中，在经过一番查询后，跳到了如下路径：HKCU\Software\Classes\xps_auto_file
如存在，请将HKCU\Software\Classes\xps_auto_file\shell\(Default)的值更改为：%SystemRoot%\System32\xpsrchvw.exe "%1"

====第3封邮件====

发件人：Li Qi
发送时间：2023-07-18 11:11:10.730000+00:00
邮件内容:
许工，您好：
       循例问下该案例是否有任何进展？如用户不方便进行更换账户登录的测试。可按如下方法对上两封邮件提到的HKCU中的注册表键值进行修改：
请使用管理员账户登录系统，打开注册表编辑器，选中HKEY_LOCAL_MACHINE，点击“文件”-“加载配置单元”，选择“c:\users\XXX(有XPS打开问题的用户名)\NTUSER.dat”（注意需要打开系统隐藏文件），确定，取个项名称，如：CMIT
在HKEY_LOCAL_MACHINE\CMIT中查找之前提到的键值是否存在并修改。
*  Software\Classes\xps_auto_file\shell\(Default)的值更改为：%SystemRoot%\System32\xpsrchvw.exe "%1"
*  SOFTWARE\Microsoft\Windows\CurrentVersion\Explorer\FileExts\.xps\UserChoice，其中ProgId的值应为：Windows.XPSReachViewer

====第4封邮件====

发件人：Li Qi
发送时间：2023-07-24 14:22:16.464000+00:00
邮件内容:
许工，您好：
       如刚才电话沟通，鉴于当前用户未反馈问题进度，经您的同意，此case将暂做归档处理，以下为案例 ，请您知悉：
Case No：CAS-09236-W3G9N7
问题描述：
=================
用户反馈V2022-L使用普通域账户访问.xps文件提示无效的位图文件或不支持文件的格式。
问题分析：
=================
经日志分析，与xps默认打开方式有关，在读取当前登录用户的注册表键值时，未找到正确的xps默认打开方式的键值，因此出现报错。建议用户修改当前用户的注册表信息或更改登录用户查看是否有相同问题，详情可查看历史邮件，对此用户未反馈处理进度。
案例总结：
=================
以上，经用户同意，该case暂做归档处理，如有其他问题，可随时联系我们，谢谢。
